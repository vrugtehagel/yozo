(()=>{var v=class{#e=[];#r=[];#n;#t;constructor(e){f.add("undo",()=>this.stop()),e?.((...t)=>{this.now(...t)})}pipe(e){return this.#e?.push(e),this}now(...e){let t=-1,r=()=>{this.#e&&(t++,!(t<this.#t)&&(this.#n&&(this.#t=t+1),this.#e.length+1==this.#t&&this.stop(),this.#e?.[t]?.(r,...e)))};return r(),this}then(e){return this.pipe((t,...r)=>{e(...r),t()})}await(e){return this.pipe(async(t,...r)=>{await e(...r),t()})}if(e){return this.pipe((t,...r)=>{e(...r)&&t()})}or(e){return e.then((...t)=>{this.now(...t)}),this.cleanup(()=>e.stop?.())}stop(){return this.#e&&this.#r.splice(0).map(e=>e()),this.#e=null,this}until(e){return typeof e=="function"?this.pipe((t,...r)=>e(...r)?this.stop():t()):(this.cleanup(()=>e.stop?.()),e.then(()=>this.stop()),this)}cleanup(e){return this.#e?this.#r.push(e):e(),this}once(){return this.then(()=>this.#n=!0)}debounce(e){let t;return this.pipe(r=>{clearTimeout(t),t=setTimeout(r,e)}).cleanup(()=>clearTimeout(t))}throttle(e){let t,r;return this.pipe(o=>{if(r)return t=o;o(),r=setInterval(()=>{if(!t){clearTimeout(r),r=0;return}t(),t=null},e)}).cleanup(()=>clearTimeout(r))}after(e){return queueMicrotask(()=>queueMicrotask(e)),this}};var E=n=>n.replace(/-+(\w?)/g,(e,t)=>t.toUpperCase()),T=n=>{let e={constructor:null};for(let t of n)for(let r of Object.keys(t))e[r]??=function(...o){n.map(u=>u[r]?.call(this,...o))};return e};var O=(...n)=>new Proxy({does:(e,t)=>{let r;return new v(o=>{r=o,n.map(u=>u.addEventListener(e,r,t))}).cleanup(()=>n.map(o=>o.removeEventListener(e,r,t)))},observes:(e,t)=>{let r;return new v(o=>{r=new self[E(`-${e}-observer`)](o,t),n.map(u=>r.observe(u,t))}).cleanup(()=>r.disconnect())}},{get:(e,t)=>e[t]??e.does.bind(null,t.replace(/s$/,""))});var S=(n,e=queueMicrotask)=>{let t,r=()=>e(()=>o.now()),o=new v().then(()=>{t?.undo(),t=f(["undo","live"],n),t.live.addEventListener("change",r,{once:!0})}).cleanup(()=>{t?.undo(),t?.live.removeEventListener("change",r,{once:!0})});return r(),o};var g=n=>new F({e:{$:g.get(n)}},"$").t,j=new WeakMap,F=class n{constructor(e,t,r=this){this.r=e,this.i=t,this.p=r,this.f={},this.t=new Proxy(new EventTarget,{get:(o,u)=>u==Symbol.iterator?()=>(f.add("live",this.t,"keychange"),[...this.e].map((s,c)=>this.n(c).t)[u]()):u[0]=="$"?this.n(u.slice(1)).t:o[u]?o[u].bind(o):(f.add("live",this.n(u).t,"deepchange"),this.e?.[u]),set:(o,u,s)=>g.set(this.n(u).t,s),deleteProperty:(o,u,s)=>g.delete(this.n(u).t),has:(o,u)=>(f.add("live",this.t,"keychange"),this.e!=null&&u in this.e||o[u]),ownKeys:()=>(f.add("live",this.t,"keychange"),Object.keys(this.e??{}).map(o=>`$${o}`)),getOwnPropertyDescriptor:()=>({configurable:!0,enumerable:!0}),defineProperty:()=>!1}),j.set(this.t,this),this.e=this.r.e?.[this.i],this.a=this.e instanceof Object?Object.keys(this.e??{}):[]}n(e){return this.f[e]??=new n(this,e,this.p)}c(e,t=new Set){let r=e?.(),o=this.e,u=this.e=this.r.e?.[this.i],s=new Set(this.a);this.a=this.e instanceof Object?Object.keys(this.e??{}):[];for(let i of this.a)s.has(i)?s.delete(i):s.add(i);if(s.size&&this.t.dispatchEvent(new CustomEvent("keychange",{detail:{keys:[...s]}})),Object.is(o,u))return r;this.t.dispatchEvent(new CustomEvent("change",{detail:{oldValue:o,value:u}}));let c=this;for(;!t.has(c)&&c.r;)c.c(null,t),t.add(c),c=c.r;for(let i of Object.values(this.f))i.c(null,t);if(e){for(let i of t)i.t.dispatchEvent(new CustomEvent("deepchange"));return r}}};g.get=(n,e)=>{let t=j.get(n);if(!t)return e==null?n:n[e];let r=e==null?t:t.n(e);return f.add("live",r.t,"deepchange"),r.e};g.set=(n,e)=>{let t=j.get(n);return!!t?.c(()=>t.r.e==null?!1:(t.r.e[t.i]=g.get(e),!0))};g.delete=(n,e)=>{let t=j.get(n);return!!t?.c(()=>t.r.e==null?!1:delete t.r.e[t.i])};g.link=(n,e)=>{let t,r=e;self.HTMLElement&&e instanceof HTMLElement?r={get:()=>e.value,set:i=>e.value=i,changes:O(e).input()}:typeof e=="function"&&(r={get:()=>t,changes:S(()=>t=e(),i=>i())});let o=new v;r.changes?.then(()=>o.now());let u,s=i=>{u=!0,g.set(n,i),t=i,u=!1},c=()=>{if(!u){if(!r.set)return s(t);r.set(f.ignore(()=>g.get(n))),s(f.ignore(r.get))}};return n.addEventListener("deepchange",c),s(f.ignore(r.get)),o.then(()=>s(f.ignore(r.get))).cleanup(()=>n.removeEventListener("deepchange",c))};var k,f=(n,e)=>{let t=k;k={};let r={};return n.map(o=>{k[o]=new D[o],r[o]=k[o].result}),r.result=e(),k=t,r},z=n=>k?new Promise(async e=>{let t=k,r=await n;Object.keys(t).some(o=>t[o].until?.())||(queueMicrotask(()=>k=t),e(r),queueMicrotask(()=>k=null))}):n;f.ignore=n=>f([],n).result;f.add=(n,...e)=>{k?.[n]?.add(...e)};f.register=(n,e)=>{D[n]??=e};var D={undo:class{#e=[];result=()=>{this.#e?.map(n=>n()),this.#e=null};add(n){return this.#e?.push(n)??n()}until(){return!this.#e}},live:class{#e=new Map;result=new EventTarget;add(n,e){let t=this.#e.get(n)??[];t.includes(e)||(t.push(e),this.#e.set(n,t),n.addEventListener(e,()=>this.result.dispatchEvent(new CustomEvent("change"))))}}};var V=n=>{let e;return function(...t){return e?.undo(),e=f(["undo"],()=>n.call(this,...t)),e.result}};var I=n=>{let e;return new v(t=>e=setInterval(t,n)).cleanup(()=>clearInterval(e))},R=n=>I(n).once(),N=()=>{let n;return new v(e=>{let t=()=>n=requestAnimationFrame(r=>{t(),e(r)});t()}).cleanup(()=>cancelAnimationFrame(n))},W=()=>{let n=0;return N().if(()=>n++).once()};var w=n=>{let e={x:new Set(["query","$","internals"]),o:new WeakMap,s:class extends HTMLElement{constructor(){super(),e.o.set(this,{x:{}}),f.ignore(()=>r.constructor.call(this,e.o.get(this)))}}},t={};n(Object.fromEntries(q.map(([o,u])=>[u,(...s)=>(t[u]??=[]).push(s)])));let r=T(q.map(([o,u])=>o(e,t[u]??[])));return Object.entries(r).map(([o,u])=>e.s.prototype[o]??=function(...s){return f.ignore(()=>u.call(this,e.o.get(this),...s))}),customElements.define(e.m,e.s),customElements.whenDefined(e.m)},q=[];w.register=(n,e,t)=>{q.push([t,e,n]),q.sort((r,o)=>r[2]-o[2])};var P=new Map,C=n=>(P.get(`${n}`)||P.set(`${n}`,fetch(n).then(async e=>{if(!e.ok)return;let t=document.createElement("template");return t.innerHTML=await e.text(),w(r=>{for(let o of t.content.children)r[o.localName]?.(Object.fromEntries([...o.attributes].map(u=>[E(u.name),u.value])),o.innerHTML)})})),P.get(`${n}`)),K=new Set,H;C.auto=n=>{if(H)return;H=n;let e=r=>{for(let o of r.querySelectorAll(":not(:defined)"))t(o.localName);for(let o of r.querySelectorAll("template"))e(o.content)},t=r=>{if(K.has(r))return;K.add(r);let o=H(r);o&&C(o)};w.register(6,Symbol(),r=>(r.u&&e(r.u),{})),document.readyState=="loading"?document.addEventListener("readystatechange",()=>e(document),{once:!0}):e(document)};w.register(0,"title",(n,[e])=>(n.m=e[1],{}));w.register(1,"meta",(n,e)=>{let t=e.filter(s=>s[0].attribute),r=[...e.filter(s=>s[0].property),...t.filter(s=>s[0].type).map(s=>[{property:s[0].as??E(s[0].attribute)}]),...e.filter(s=>s[0].method).map(s=>[{property:s[0].method,readonly:!0}])];return r.map(([s])=>{let c=function(){return f.ignore(()=>g.get(n.o.get(this).x.$,s.property))};Object.defineProperty(n.s.prototype,s.property,"readonly"in s?{get:c}:{get:c,set:function(i){n.o.get(this).x.$[s.property]=i}})}),n.s.observedAttributes=t.map(s=>s[0].attribute),n.s.formAssociated=e.some(s=>s[0].formAssociated!=null),{constructor:function(s){s.x.$=g({attributes:{}}),t.map(([c])=>{let i=E(c.attribute);if(s.x.$.$attributes[i]=null,s.x.$.$attributes[`$${i}`].addEventListener("change",()=>{let l=g.get(s.x.$.$attributes,i);this.getAttribute(i)!=l&&(l==null?this.removeAttribute(c.attribute):this.setAttribute(c.attribute,l))}),c.type=="boolean")g.link(s.x.$[`$${c.as??i}`],{get:()=>g.get(s.x.$.$attributes,i)!=null,set:l=>s.x.$.$attributes[i]=l?"":null,changes:O(s.x.$.$attributes[`$${i}`]).change()});else if(c.type){let l=self[E(`-${c.type}`)];g.link(s.x.$[`$${c.as??i}`],{get:()=>l(g.get(s.x.$.$attributes,i)??c.default??""),set:a=>s.x.$.$attributes[i]=a==null?null:`${a}`,changes:O(s.x.$.$attributes[`$${i}`]).change()})}}),s.x.internals=this.attachInternals?.(),r.map(([{property:c}])=>{if(!Object.hasOwn(this,c))return;let i=this[c];delete this[c],this[c]=i})},attributeChangedCallback:function(s,c,i,l){s.x.$.$attributes[E(c)]=l}}});w.register(2,"meta",(n,e)=>T([...e,[{hook:"connected",unhook:"disconnected"}],[{hook:"disconnected"}]].map(t=>{let{hook:r,unhook:o}=t[0];if(!r)return{};let u=Symbol(),s=Symbol();n.x.add(r);let c=function(i){i.x[r]=l=>{let a=[new v().then((...m)=>{a[1]?.undo(),a[1]=f(["undo"],()=>l?.(...m))}).cleanup(()=>{a[1]?.undo(),i[u].delete(a)})];return i[u].add(a),i[s]&&queueMicrotask(()=>a[0].now(...i[s])),a[0]},i[u]=new Set};return o?{constructor:c,[`${r}Callback`]:function(i,...l){i[s]=l;for(let a of i[u])a[0].now(...l)},[`${o}Callback`]:function(i,...l){i[s]=null;for(let a of i[u])a[1]?.undo()}}:{constructor:c,[`${r}Callback`]:function(i,...l){i[s]=l;for(let a of i[u])a[0].now(...l)}}})));w.register(3,Symbol(),n=>{let e=new Map,t=(r,...o)=>{if(e.get(r))return e.get(r);let u=[];e.set(r,u);let s=document.createNodeIterator(r,5),c;for(;c=s.nextNode();)if(c.nodeType==3){let i=c.textContent.split(/{{([^]*?)}}/g);c.after(...i),c.remove(),u.push(...i.map((l,a)=>{if(c=s.nextNode(),!a||a&1)return;let m=new Function(...o,`return(${i[a-1]})`);return(A,p,d)=>S(()=>{let h=m(...d.map(b=>b[1]));p.previousSibling.remove(),p.before(h)})}))}else if(c.getAttribute("#for")){let[i,l]=c.getAttribute("#for").split(" of ");c.before(""),c.removeAttribute("#for"),c.remove();let a=c.localName=="template"?c.content:c,m=new Function(...o,`return(${l})`);u.push((A,p,d)=>{let h=[];f.add("undo",()=>h.splice(0).map(b=>b[1].undo())),S(()=>{let b=[...m(...d.map($=>$[1]))];for(;h.length>b.length;)h.pop()[1].undo();b.map(($,x)=>{h[x]&&h[x][0]===$||(h[x]?.[1].undo(),h[x]=[$,f(["undo"],()=>{let y=A.l(a,[...d,[i,$]]),M=y.nodeType==11?[...y.childNodes]:[y];return f.add("undo",()=>M.map(L=>L.remove())),(h[x-1]?.[1].result.at(-1)??p).after(...M),M})])})})})}else if(c.getAttribute("#if")){c.before("");let i=c.previousSibling,l=[],a=[],m=p=>{let d=i.nextElementSibling;if(d?.hasAttribute(p)){for(;i.nextSibling!=d;)i.nextSibling.remove();return l.push(`()=>(${d.getAttribute(p)||!0})`),a.push(d.localName=="template"?d.content:d),d.removeAttribute(p),d.remove(),!0}};for(m("#if");m("#else-if"););m("#else");let A=new Function(...o,`return[${l}].findIndex(e=>e())`);u.push((p,d,h)=>{let b,$,x=[];f.add("undo",()=>b?.undo()),S(()=>{let y=A(...h.map(M=>M[1]));y!=$&&(b?.undo(),$=y,a[y]&&(b=f(["undo"],()=>{let M=p.l(a[y],h),L=M.nodeType==11?M.childNodes:[M];f.add("undo",()=>x.splice(0).map(U=>U.remove())),x.push(...L),d.after(...L)})))})})}else{let i=[...c.attributes].map(l=>{if(l.name[0]==":"){let a=l.name.slice(1),m=new Function(...o,`return(${l.value})`);return c.removeAttribute(l.name),(A,p,d)=>S(()=>{let h=m.call(p,...d.map(b=>b[1]));a.slice(0,6)=="class+"?p.classList.toggle(a.slice(6),h??""):h==null?p.removeAttribute(a):p.setAttribute(a,h)})}else if(l.name[0]=="."){let a=l.name.slice(1).split(".").map(E),m=new Function(...o,`return(${l.value})`);return c.removeAttribute(l.name),(A,p,d)=>S(()=>{let h=m.call(p,...d.map(y=>y[1])),b=[...a],$=b.pop(),x=p;b.map(y=>x=x?.[y]),x!=null&&(x[$]=h)})}else if(l.name[0]=="@"){let a=l.name.slice(1),m=new Function(...o,"event",l.value);return c.removeAttribute(l.name),(A,p,d)=>{let h=b=>f.ignore(()=>m.call(p,...d.map($=>$[1]),b));p.addEventListener(a,h),f.add("undo",()=>p.removeEventListener(a,h))}}});u.push((...l)=>{i.map(a=>a?.(...l))})}return u};return{constructor:function(r){r.l=(o,u,s=c=>c())=>{let c=t(o,...u.map(m=>m[0])),i=o.cloneNode(!0),l=document.createNodeIterator(i,5),a=c.map(m=>[l.nextNode(),m]).filter(([m,A])=>A);return s(()=>{a.map(m=>m[1](r,m[0],u))}),i}}}});w.register(5,"template",(n,[e])=>{if(!e)return{constructor:function(r){r.root=this}};let t=document.createElement("template");return t.innerHTML=e[1],n.u=t.content,e[0].mode?{constructor:function(r){r.root=this.attachShadow(e[0]),r.root.append(r.l(n.u,[[`{${[...n.x]}}`,r.x]],r.x.connected)),customElements.upgrade(r.root)}}:{constructor:function(r){r.root=r.l(n.u,[[`{${[...n.x]}}`,r.x]],r.x.connected),customElements.upgrade(r.root)},connectedCallback:function(r){r.root!=this&&(this.replaceChildren(r.root),r.root=this)}}});w.register(7,Symbol(),n=>({constructor:function(e){e.x.query=t=>e.root.querySelector(t),e.x.query.all=t=>[...e.root.querySelectorAll(t)]}}));w.register(8,"style",(n,[e])=>{if(!e)return{};let t=new CSSStyleSheet;return t.replaceSync(e[1]),{constructor:function(r){r.x.connected(()=>{let o=r.root.mode?r.root:this.getRootNode(),u=o.adoptedStyleSheets;u.includes(t)||(o.adoptedStyleSheets=[...u,t])})}}});w.register(10,"script",(n,[e])=>{if(!e)return{};let t=new Function(`{${[...n.x]}}`,`const{${Object.keys(self.yozo)}}=self.yozo;${e[1]}`);return{constructor:function(r){t.call(this,r.x)}}});self.yozo={monitor:f,until:z,Flow:v,live:g,when:O,purify:V,effect:S,frame:N,interval:I,paint:W,timeout:R};Object.defineProperty(self.yozo,"register",{value:C});})();
