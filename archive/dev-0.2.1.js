// Yozo version: 0.2.1
(()=>{var C=(e=console.log,t)=>(r,...o)=>{let n=String.raw(r,...o),i=String.raw(r,...o.map((c,u)=>`$${u+1}`));if(t&&C.memory.has(n))return;C.memory.add(n);let l=H[i](...o).replaceAll(/^\s+/gm,"").trim();t&&(l+=`
`+t),e(l)};C.memory=new Set;var S=C(e=>{throw new Error(e)}),y=C(e=>console.warn(e)),W=C(e=>console.warn(e),"Warnings after this one will be suppressed"),H={"when-arg-not-event-target":()=>`
		Could not attach event listener(s) with when(\u2026);
		Not all of its arguments were EventTargets.`,"when-cannot-observe-$1-no-$2":(e,t)=>`
		Failed at when(\u2026).observe('${e}').
		This occurred because "${t}Observer" doesn't exist.`,"when-$1-instead-of-$2-mistake":(e,t)=>`
		when(\u2026).{property}() may be a mistake, as it listens to the "${t}" event.
		If you want to listen to the "${e}" event, use .does('${e}').`,"monitor-add-$1-not-in-registry":e=>`
		An item was added to "${e}", but "${e}" was not registered.
		Register it first using monitor.register('${e}', class { \u2026 }).`,"monitor-cannot-register-result":()=>`
		"result" cannot be registered as a monitorable.
		Tracked calls already store their result under this key.`,"monitor-registry-already-has-$1":e=>`
		monitor.register('${e}', \u2026) was called, but "${e}" was already registerd.
		You cannot overwrite an existing registration; re-registrations are ignored.`,"monitor-$1-definition-must-be-class":e=>`
		Registering "${e}", but its definition was not a class.
		Register it using monitor.register('${e}', class { \u2026 }).`,"flow-stopped-but-triggered":()=>`
		A flow was triggered after it stopped. Often, this indicates a memory leak.
		Make sure you use .cleanup(\u2026) to undo everything triggering the flow.`,"live-$1-on-non-live":e=>`
		live.${e}(\u2026) was called, but its first argument wasn't live.
		This was probably a mistake; it does nothing.`,"live-link-target-$1-not-live":e=>`
		Something non-live was passed to live.link(\u2026).
		Probably, you missed the $ in .$${e}.`,"live-link-target-not-live":()=>`
		Something non-live was passed to live.link(\u2026).
		Make sure its first argument is a live variable.`,"live-property-$1-doubled":e=>`
		Objects with (nested) live properties should not be live themselves.
		Now .${e} is live and .$${e} is double-live, which is confusing.`,"live-property-set-$1-has-$":e=>`
		The "${e}" property was set, which may have been unintentional.
		To set the "${e.slice(1)}" property instead, use $object.${e.slice(1)} = \u2026.`,"live-property-delete-$1-has-$":e=>`
		The "${e}" property was deleted, which may have been unintentional.
		To delete the "${e.slice(1)}" property, use delete $object.${e.slice(1)}.`,"define-missing-title":()=>`
		Component definition is missing <title>\u2026</title>.
		This is required, as it determines the component's tag name.`,"define-attribute-$1-type-$2-does-not-exist":(e,t)=>`
		Attribute "${e}" defined type "${t}", but that doesn't exist.
		The type attribute is converted to PascalCase, and that must be a global.`,"transform-for-$1-not-iterable":e=>`
		Expression "${e}" in #for is not iterable.`,"transform-if-found-loose-$1":e=>`
		Found an "${e}" attribute without an #if.
		Make sure the element follows an element with an #if or #else-if.`};var h=Symbol(),m=Symbol(),b=e=>e.replace(/-+(\w)?/g,(t,r="")=>r?.toUpperCase()),N=e=>e.replace(/[A-Z]/g,"-$&").toLowerCase(),O=e=>{let t={constructor:null};for(let r of e)for(let o of Object.keys(r))t[o]??=function(...n){e.map(i=>i[o]?.call(this,...n))};return t};var w=class{#e=[];#o=[];#t;#n;#r;constructor(t){a.add("undo",()=>this.stop()),t?.((...r)=>{this.#t&&y`flow-stopped-but-triggered`,this.now(...r)})}flow(t){return this.#e.push(t),this}now(...t){let r=-1,o=()=>{this.#t||(r++,!(r<this.#r)&&(this.#n&&(this.#r=r+1),this.#e.length+1==this.#r&&this.stop(),this.#e[r]?.(o,...t)))};return o(),this}then(t){return this.flow((r,...o)=>{t(...o),r()})}await(t){return this.flow(async(r,...o)=>{await t(...o),r()})}if(t){return this.flow((r,...o)=>{t(...o)&&r()})}or(t){return t.then((...r)=>this.now(...r)),this.cleanup(()=>t.stop?.())}stop(){if(!this.#t)return this.#t=!0,this.#e.splice(0),this.#o.splice(0).map(t=>t()),this}until(t){return typeof t=="function"?this.flow((r,...o)=>t(...o)?this.stop():r()):(this.cleanup(()=>t.stop?.()),t.then(()=>this.stop()),this)}cleanup(t){return this.#t?t():this.#o.push(t),this}once(){return this.then(()=>this.#n=!0)}debounce(t){let r;return this.flow(o=>{clearTimeout(r),r=setTimeout(o,t)}).cleanup(()=>clearTimeout(r))}throttle(t){let r,o;return this.flow(n=>{if(o)return r=n;n(),o=setInterval(()=>{if(!r){clearTimeout(o),o=0;return}r(),r=null},t)}).cleanup(()=>clearTimeout(o))}after(t){return queueMicrotask(()=>queueMicrotask(t)),this}};var d=(...e)=>new Proxy({does:(t,r)=>{let o;return new w(n=>{o=n,e.every(i=>typeof i?.addEventListener=="function")||S`when-arg-not-event-target`,e.map(i=>i.addEventListener(t,o,r))}).cleanup(()=>e.map(n=>n.removeEventListener(t,o,r)))},observes:(t,r)=>{let o;return new w(n=>{let i=b(`-${t}-observer`);typeof self[i]!="function"&&S`when-cannot-observe-${t}-no-${i}`,o=new self[b(`-${t}-observer`)](n,r),e.map(s=>o.observe(s,r))}).cleanup(()=>o.disconnect())}},{get:(t,r)=>{let o=r.replace(/s$/,"");return!t[r]&&o!=r&&"on"+r in self&&y`when-${r}-instead-of-${o}-mistake`,t[r]??t.does.bind(null,r.replace(/s$/,""))}});var $=(e,t=queueMicrotask)=>{let r,o=new w;return o.then(()=>{let n=a(["live","undo"],e);r=a.ignore(()=>d(n.live).change()).once().then(()=>t(()=>o.now())).cleanup(()=>n.undo())}).cleanup(()=>r?.stop()),t(()=>o.now()),o};var p=e=>new A({e:{$:p.get(e)}},"$").t;p[m]=new WeakMap;var P=new WeakMap,E=async e=>{E.recent=e,await"mircrotask",E.recent=null},A=class{constructor(t,r,o=this){this.r=t,this.i=r,this.h=o,this.m={},this.t=new Proxy(new EventTarget,{get:(n,i)=>i==Symbol.iterator?(E(i),()=>(a.add("live",this.t,"keychange"),[...this.e].map((s,l)=>this.o(l).t)[Symbol.iterator]())):i[0]=="$"?this.o(i.slice(1)).t:(E(i),n[i]?n[i].bind(n):(a.add("live",this.o(i).t,"deepchange"),this.e?.[i])),set:(n,i,s)=>(i[0]=="$"&&y`live-property-set-${i}-has-$`,p.set(this.o(i).t,s)),deleteProperty:(n,i,s)=>(i[0]=="$"&&y`live-property-delete-${i}-has-$`,p.delete(this.o(i).t)),has:(n,i)=>(a.add("live",this.t,"keychange"),this.e!=null&&n[i]||i in this.e),ownKeys:()=>(a.add("live",this.t,"keychange"),Object.keys(this.e??{}).map(n=>`$${n}`)),getOwnPropertyDescriptor:()=>({configurable:!0,enumerable:!0}),defineProperty:()=>!1}),p[m].set(this.t,this),o==this&&P.set(this,new Set),P.get(o).add(new WeakRef(this)),this.e=this.r.e?.[this.i],this.p=Object.keys(this.e??{})}o(t){return this.m[t]??=new A(this,t,this.h)}c(t,r=new Set([this])){let o=t?.(),n=this.e,i=this.r.e?.[this.i];this.e=i,Object.is(n,i)||this.t.dispatchEvent(new CustomEvent("change",{detail:{oldValue:n,value:i}}));let s=Object.keys(this.e??{}),l=new Set(this.p);this.p=s;for(let u of s)l.has(u)?l.delete(u):l.add(u);l.size&&this.t.dispatchEvent(new CustomEvent("keychange",{detail:{keys:[...l]}}));let c=this.r;for(r.add(this);!r.has(c)&&c.r;)c.c(null,r),r.add(c),c=c.r;if(Object.is(n,i))return o;for(let u of Object.values(this.m))u.c(null,r);if(t){for(let u of r)u.t.dispatchEvent(new CustomEvent("deepchange"));return o}}};p.get=(e,t)=>{let r=p[m].get(e);return r?(E(t??r.i),t!=null?r.o(t).e:(a.add("live",e,"deepchange"),r.e)):t==null?e:e[t]};p.set=(e,t)=>{let r=p[m].get(e);return!!r?.c(()=>r.r.e==null?!1:(r.r.e[r.i]=p.get(t),!0))};p.delete=(e,t)=>{let r=p[m].get(e);return!!r?.c(()=>r.r.e==null?!1:delete r.r.e[r.i])};p.link=(e,t)=>{p[m].has(e)||(E.recent?S`live-link-target-${E.recent}-not-live`:S`live-link-target-not-live`);let r,o=t;t instanceof HTMLElement?o={get:()=>t.value,set:l=>t.value=l,changes:d(t).input()}:typeof t=="function"&&(o={get:()=>r,changes:$(()=>r=t(),l=>l())});let n,i=l=>{n=!0,p.set(e,l),r=l,n=!1},s=d(e).deepchange().then(()=>{if(!n){if(!o.set)return i(r);o.set(a.ignore(()=>p.get(e))),i(a.ignore(o.get))}});return i(a.ignore(o.get)),(o.changes??new w).then(()=>i(a.ignore(o.get))).if(()=>null).cleanup(()=>s.stop())};var a=(e,t)=>{let r=a[h];a[h]={};let o={};for(let n of e)o[n]=(a[h][n]=new a[m][n]).result;return o.result=t(),a[h]=r,o},R=e=>{if(!a[h])return e;let t=a[h];return a[h]=null,{then:r=>Promise.resolve(e).then(o=>{Object.keys(t).some(n=>t[n].until?.())||(queueMicrotask(()=>a[h]=t),r(o),queueMicrotask(()=>a[h]=null))})}};a.ignore=e=>a([],e).result;a.add=(e,...t)=>{a[m][e]||y`monitor-add-${e}-not-in-registry`,a[h]?.[e]?.add(...t)};a[m]={result:!0};a.register=(e,t)=>{e=="result"&&y`monitor-cannot-register-result`,a[m][e]&&y`monitor-registry-already-has-${e}`,!a[m][e]&&(a[m][e]??=t)};a.register("undo",class{[m]=[];#e;result=()=>{this.#e||(this[m].splice(0).map(e=>e()),this.#e=!0)};add(e){if(this.#e)return e();this[m].push(e)}until(){return this.#e}});a.register("live",class{[m]=new Map;result=new EventTarget;add(e,t){let r=this[m].get(e)??[];r.includes(t)||(r.push(t),this[m].set(e,r),a.ignore(()=>d(e).does(t)).then(()=>this.result.dispatchEvent(new CustomEvent("change"))))}});var L=e=>{let t;return(...r)=>(t?.undo(),t=a(["undo"],()=>e(...r)),t.result)};var q=e=>{let t;return new w(r=>t=setInterval(r,e)).cleanup(()=>clearInterval(t))},I=e=>q(e).once(),F=()=>{let e;return new w(t=>{let r=()=>e=requestAnimationFrame(o=>{r(),t(o)});r()}).cleanup(()=>cancelAnimationFrame(e))},z=()=>{let e=0;return F().if(()=>e++).once()};var f=e=>{let t={x:new Set,s:new WeakMap,l:class extends HTMLElement{constructor(){super(),t.s.set(this,{x:{}}),a.ignore(()=>n.constructor.call(this,t.s.get(this)))}}},r={};e(Object.fromEntries(f[m].map(([i,s])=>[s,(...l)=>(r[s]??=[]).push(l)])));let o=f[m].map(([i,s])=>i(t,r[s]??[])),n=O(o);for(let i of Object.keys(n))t.l.prototype[i]??=function(...s){a.ignore(()=>n[i].call(this,t.s.get(this),...s))};return t.f||S`define-missing-title`,customElements.define(t.f,t.l),customElements.whenDefined(t.f)};f[m]=[];f[h]=[];f.register=(e,t,r)=>{f[m].push([r,t,e]),f[m].sort((o,n)=>o[2]-n[2])};f.transform=(e,t)=>{f[h].push([t,e]),f[h].sort((r,o)=>r[1]-o[1])};var T=async e=>{if(T[m].has(`${e}`))return;T[m].add(`${e}`);let t=await fetch(e),r=document.createElement("template");return r.innerHTML=await t.text(),f(o=>{for(let n of r.content.children)o[n.localName]?.(Object.fromEntries([...n.attributes].map(i=>[b(i.name),i.value])),n.innerHTML)})};T[m]=new Set;var M,D;T.auto=e=>{if(M)return;M=new Set;let t=o=>{if(M.has(o))return;M.add(o);let n=e(o);n&&T(n)},r=o=>{for(let n of o.querySelectorAll(":not(:defined)"))t(n.localName);for(let n of o.querySelectorAll("template"))r(n.content)};return f.register(6,null,o=>D?{}:o.a?(r(o.a),{}):{},{}),d(document).observes("mutation",{childList:!0,subtree:!0}).then(()=>r(document)).now().if(()=>null).cleanup(()=>D=!0)};f.register(0,"title",(e,[t])=>(e.f=t?.[1],{}));f.register(1,"meta",(e,t)=>{e.x.add("$");let r=t.filter(s=>s[0].attribute),o=[...t.filter(s=>s[0].property),...r.filter(s=>s[0].type).map(s=>[{property:s[0].as??b(s[0].attribute)}]),...t.filter(s=>s[0].method).map(s=>[{property:s[0].method,readonly:""}])];for(let[s]of o){let l=function(){return a.ignore(()=>p.get(e.s.get(this).x.$,s.property))},c=function(u){a.ignore(()=>e.s.get(this).x.$[s.property]=u)};Object.defineProperty(e.l.prototype,s.property,"readonly"in s?{get:l}:{get:l,set:c})}return e.l.observedAttributes=r.map(s=>s[0].attribute),e.l.formAssociated=t.some(s=>s[0].formAssociated!=null),{constructor:function(s){s.x.$=p({attributes:{}}),s.x.$.attributes={};for(let[l]of r){let c=b(l.attribute);if(s.x.$.$attributes[c]=null,d(s.x.$.$attributes[`$${c}`]).change().then(()=>{let u=p.get(s.x.$.$attributes,c);u==null?this.removeAttribute(l.attribute):this.setAttribute(l.attribute,u)}),l.type=="boolean")p.link(s.x.$[`$${l.as??c}`],{get:()=>p.get(s.x.$.$attributes,c)!=null,set:u=>s.x.$.$attributes[c]=u?"":null,changes:d(s.x.$.$attributes[`$${c}`]).change()});else if(l.type){let u=self[b(`-${l.type}`)];u||S`define-attribute-${l.attribute}-type-${u}-does-not-exist`,p.link(s.x.$[`$${l.as??c}`],{get:()=>u(p.get(s.x.$.$attributes,c)??l.default??""),set:v=>s.x.$.$attributes[c]=v==null?null:`${v}`,changes:d(s.x.$.$attributes[`$${c}`]).change()})}}for(let[{property:l}]of o){if(!Object.hasOwn(this,l))continue;let c=this[l];delete this[l],this[l]=c}},attributeChangedCallback:function(s,l,c,u){s.x.$.$attributes[b(l)]=u}}});f.register(2,"meta",(e,t)=>O([...t,[{hook:"connected",unhook:"disconnected"}],[{hook:"disconnected"}]].filter(r=>r[0].hook).map(r=>{let{hook:o,unhook:n}=r[0];e.x.add(o);let i=function(l){l.x[o]=c=>{let u=[new w().then((...v)=>{u[1]?.undo(),u[1]=a(["undo"],()=>c?.(...v))}).cleanup(()=>{u[1]?.undo(),l.x[o][m].delete(u)})];return l.x[o][m].add(u),l.x[o][h]&&queueMicrotask(()=>u[0].now(...l.x[o][h])),u[0]},l.x[o][m]=new Set},s=function(l,...c){l.x[o][h]=c;for(let u of l.x[o][m])u[0].now(...c)};return n?{constructor:i,[`${o}Callback`]:s,[`${n}Callback`]:function(l,...c){l.x[o][h]=null;for(let u of l.x[o][m])u[1]?.undo()}}:{constructor:i,[`${o}Callback`]:s}})));f.register(3,Symbol(),e=>({constructor:function(r){r.n=(o,...n)=>{let i=n.map(()=>`$${b(crypto.randomUUID())}`),s=new Function(...i,`var ${n.map((l,c)=>`${l[0]}=${i[c]}`)};return(${o})`);return(l,...c)=>s.call(l,...c.map(u=>u[1]))},r.u=(o,...n)=>a.ignore(()=>{let i=o.cloneNode(!0),s=document.createNodeIterator(i,5),l;e:for(;l=s.nextNode();){if(l.nodeType==1){for(let[c]of f[h])for(let u of[...l.attributes])if(c(u,n,r,e),s.referenceNode!=l)continue e}for(let[c]of f[h])if(c(l,n,r,e),s.referenceNode!=l)continue e}return i})}}));f.register(5,"template",(e,[t])=>{if(!t)return{constructor:function(s){s.root=this}};let r=document.createElement("template");return r.innerHTML=t[1],e.a=r.content,t[0].mode?{constructor:function(s){s.root=this.attachShadow(t[0]),s.root.append(s.u(e.a,[`{${[...e.x]}}`,s.x])),customElements.upgrade(s.root)}}:{constructor:function(i){i.root=i.u(e.a,[`{${[...e.x]}}`,i.x]),customElements.upgrade(i.root)},connectedCallback:function(i){this.replaceChildren(i.root),i.root=this}}});f.register(7,Symbol(),e=>(e.x.add("elements"),{constructor:function(r){let o={all:n=>[...r.root.querySelectorAll(n)],shadow:r.root.mode?r.root:null};r.x.elements=new Proxy(n=>r.root.querySelector(n),{get:(n,i)=>o[i]??=n(`#${N(i)},#${i}`)??n(N(i))})}}));f.register(8,"style",(e,[t])=>{if(!t)return{};let r=new CSSStyleSheet;return r.replace(t[1]),{connectedCallback:function(n){let i=n.x.elements.shadow??this.getRootNode(),s=i.adoptedStyleSheets;s.includes(r)||(i.adoptedStyleSheets=[...s,r])}}});f.register(10,"script",(e,[t])=>{if(!t)return{};let r=new Function(`{${[...e.x]}}`,`const{${Object.keys(self.yozo)}}=self.yozo;${t[1]}`);return{constructor:function(n){r.call(this,n.x)}}});f.transform(0,(e,t,r,o)=>{if(e.nodeType!=3)return;let n=e.textContent.split(/{{([^]*?)}}/g);e.before(...n);let i=e;for(let s=1;s<n.length;s+=2){i=i.previousSibling.previousSibling;let l=i,c=r.n(l.textContent,...t);r.x.connected(()=>$(()=>{l.textContent=c(null,...t)}))}e.remove()});f.transform(1,(e,t,r,o)=>{if(e.nodeType!=2||e.name!="#for")return;let n=e.ownerElement;n.removeAttribute(e.name);let[i,s]=e.value.split(" of ");n.before("");let l=n.previousSibling;n.remove();let c=[],u=r.n(s,...t);r.x.connected(()=>$(()=>{let v=u(n,...t);for(typeof v?.[Symbol.iterator]!="function"&&S`transform-for-${s}-not-iterable`;c.length>v.length;)c.pop()[1].map(g=>g.remove());let x=-1;for(let g of v){if(x++,c[x]&&c[x][0]===g)continue;let k=r.u(n.localName=="template"?n.content:n,...t,[i,g]);c[x]?.[1].map(j=>j.remove()),c[x]=[g,k.nodeType==11?[...k.childNodes]:[k]],(c[x-1]?.[1].at(-1)??l).after(...c[x][1])}}))});f.transform(2,(e,t,r,o)=>{if(e.nodeType!=2||((e.name=="#else-if"||e.name=="#else")&&y`transform-if-found-loose-${e.name}`,e.name!="#if"))return;e.ownerElement.before("");let n=e.ownerElement.previousSibling,i=[],s=[],l=n,c=g=>{if(l.nextElementSibling?.hasAttribute(g))return l=l.nextElementSibling,i.push(`()=>(${l.getAttribute(g)})`),s.push(l.localName=="template"?l.content:l),l.removeAttribute(g),!0};for(c("#if");c("#else-if"););for(c("#else")&&(i[i.length-1]="()=>1");n.nextSibling!=l;)n.nextSibling.remove();l.remove();let u,v=r.n(`[${i}].findIndex(e=>e())`,...t),x=[];r.x.connected(()=>$(()=>{let g=v(null,...t);if(g==u||(u=g,x.splice(0).map(j=>j.remove()),!s[g]))return;let k=r.u(s[g],...t);x.push(...k.nodeType==11?k.childNodes:[k]),n.after(...x)}))});f.transform(3,(e,t,r,o)=>{if(e.nodeType!=2||e.name[0]!=":")return;let n=e.ownerElement,i=e.name.slice(1);n.removeAttribute(e.name);let s=r.n(e.value,...t);r.x.connected(()=>$(()=>{let l=s(n,...t);l==null?n.removeAttribute(i):n.setAttribute(i,l)}))});f.transform(4,(e,t,r,o)=>{if(e.nodeType!=2||e.name[0]!=".")return;let n=e.ownerElement;n.removeAttribute(e.name);let i=e.name.slice(1).split(".").at(-1),s=e.name.slice(1).split(".").map(b),l=r.n(e.value||!0,...t);r.x.connected(()=>$(()=>{let c=l(n,...t),u=n,v=[...s],x=v.pop();for(let g of v)u=u?.[g];u instanceof DOMTokenList?u.toggle(i,c):u!=null&&(u[x]=c)}))});f.transform(5,(e,t,r,o)=>{if(e.nodeType!=2||e.name[0]!="@")return;let n=e.ownerElement,i=e.name.slice(1);n.removeAttribute(e.name);let s=r.n(e.value,...t,["event"]);r.x.connected(()=>{d(n).does(i).then(l=>{a.ignore(()=>s(n,...t,["event",l]))})})});self.yozo={monitor:a,until:R,Flow:w,live:p,when:d,purify:L,effect:$,frame:F,interval:q,paint:z,timeout:I};Object.defineProperty(self.yozo,"register",{value:T});})();
