(()=>{var h=Symbol(),m=Symbol(),v=r=>r.replace(/-+(\w?)/g,(t,e)=>e.toUpperCase()),k=r=>{let t={constructor:null};for(let e of r)for(let n of Object.keys(e))t[n]??=function(...o){r.map(c=>c[n]?.call(this,...o))};return t};var w=class{#t=[];#n=[];#e;#o;#r;constructor(t){l.add("undo",()=>this.stop()),t?.((...e)=>{this.now(...e)})}flow(t){return this.#t.push(t),this}now(...t){let e=-1,n=()=>{this.#e||(e++,!(e<this.#r)&&(this.#o&&(this.#r=e+1),this.#t.length+1==this.#r&&this.stop(),this.#t[e]?.(n,...t)))};return n(),this}then(t){return this.flow((e,...n)=>{t(...n),e()})}await(t){return this.flow(async(e,...n)=>{await t(...n),e()})}if(t){return this.flow((e,...n)=>{t(...n)&&e()})}or(t){return t.then((...e)=>this.now(...e)),this.cleanup(()=>t.stop?.())}stop(){if(!this.#e)return this.#e=!0,this.#t.splice(0),this.#n.splice(0).map(t=>t()),this}until(t){return typeof t=="function"?this.flow((e,...n)=>t(...n)?this.stop():e()):(this.cleanup(()=>t.stop?.()),t.then(()=>this.stop()),this)}cleanup(t){return this.#e?t():this.#n.push(t),this}once(){return this.then(()=>this.#o=!0)}debounce(t){let e;return this.flow(n=>{clearTimeout(e),e=setTimeout(n,t)}).cleanup(()=>clearTimeout(e))}throttle(t){let e,n;return this.flow(o=>{if(n)return e=o;o(),n=setInterval(()=>{if(!e){clearTimeout(n),n=0;return}e(),e=null},t)}).cleanup(()=>clearTimeout(n))}after(t){return queueMicrotask(()=>queueMicrotask(t)),this}};var d=(...r)=>new Proxy({does:(t,e)=>{let n;return new w(o=>{n=o,r.map(c=>c.addEventListener(t,n,e))}).cleanup(()=>r.map(o=>o.removeEventListener(t,n,e)))},observes:(t,e)=>{let n;return new w(o=>{n=new self[v(`-${t}-observer`)](o,e),r.map(c=>n.observe(c,e))}).cleanup(()=>n.disconnect())}},{get:(t,e)=>t[e]??t.does.bind(null,e.replace(/s$/,""))});var g=(r,t=queueMicrotask)=>{let e,n=new w().then(()=>{let o=l(["undo","live"],r);e=l.ignore(()=>d(o.live).change()).once().then(()=>t(()=>n.now())).cleanup(()=>o.undo())}).cleanup(()=>e?.stop());return t(()=>n.now()),n};var p=r=>new E({t:{$:p.get(r)}},"$").e;p[m]=new WeakMap;var O=new WeakMap,E=class{constructor(t,e,n=this){this.r=t,this.c=e,this.h=n,this.a={},this.e=new Proxy(new EventTarget,{get:(o,c)=>c==Symbol.iterator?()=>(l.add("live",this.e,"keychange"),[...this.t].map((s,i)=>this.n(i).e)[c]()):c[0]=="$"?this.n(c.slice(1)).e:o[c]?o[c].bind(o):(l.add("live",this.n(c).e,"deepchange"),this.t?.[c]),set:(o,c,s)=>p.set(this.n(c).e,s),deleteProperty:(o,c,s)=>p.delete(this.n(c).e),has:(o,c)=>(l.add("live",this.e,"keychange"),this.t!=null&&o[c]||c in this.t),ownKeys:()=>(l.add("live",this.e,"keychange"),Object.keys(this.t??{}).map(o=>`$${o}`)),getOwnPropertyDescriptor:()=>({configurable:!0,enumerable:!0}),defineProperty:()=>!1}),p[m].set(this.e,this),n==this&&O.set(this,new Set),O.get(n).add(new WeakRef(this)),this.t=this.r.t?.[this.c],this.m=Object.keys(this.t??{})}n(t){return this.a[t]??=new E(this,t,this.h)}u(t,e=new Set([this])){let n=t?.(),o=this.t,c=this.r.t?.[this.c];this.t=c,Object.is(o,c)||this.e.dispatchEvent(new CustomEvent("change",{detail:{oldValue:o,value:c}}));let s=Object.keys(this.t??{}),i=new Set(this.m);this.m=s;for(let f of s)i.has(f)?i.delete(f):i.add(f);i.size&&this.e.dispatchEvent(new CustomEvent("keychange",{detail:{keys:[...i]}}));let u=this.r;for(e.add(this);!e.has(u)&&u.r;)u.u(null,e),e.add(u),u=u.r;if(Object.is(o,c))return n;for(let f of Object.values(this.a))f.u(null,e);if(t){for(let f of e)f.e.dispatchEvent(new CustomEvent("deepchange"));return n}}};p.get=(r,t)=>{let e=p[m].get(r);return e?t!=null?e.n(t).t:(l.add("live",r,"deepchange"),e.t):t==null?r:r[t]};p.set=(r,t)=>{let e=p[m].get(r);return!!e?.u(()=>e.r.t==null?!1:(e.r.t[e.c]=p.get(t),!0))};p.delete=(r,t)=>{let e=p[m].get(r);return!!e?.u(()=>e.r.t==null?!1:delete e.r.t[e.c])};p.link=(r,t)=>{let e,n=t;t instanceof HTMLElement?n={get:()=>t.value,set:i=>t.value=i,changes:d(t).input()}:typeof t=="function"&&(n={get:()=>e,changes:g(()=>e=t(),i=>i())});let o,c=i=>{o=!0,p.set(r,i),e=i,o=!1},s=d(r).deepchange().then(()=>{if(!o){if(!n.set)return c(e);n.set(l.ignore(()=>p.get(r))),c(l.ignore(n.get))}});return c(l.ignore(n.get)),(n.changes??new w).then(()=>c(l.ignore(n.get))).if(()=>null).cleanup(()=>s.stop())};var l=(r,t)=>{let e=l[h];l[h]={};let n={};return r.map(o=>{l[h][o]=new l[m][o],n[o]=l[h][o].result}),n.result=t(),l[h]=e,n},M=r=>{if(!l[h])return r;let t=l[h];return l[h]=null,{then:e=>Promise.resolve(r).then(n=>{Object.keys(t).some(o=>t[o].until?.())||(queueMicrotask(()=>l[h]=t),e(n),queueMicrotask(()=>l[h]=null))})}};l.ignore=r=>l([],r).result;l.add=(r,...t)=>{l[h]?.[r]?.add(...t)};l.register=(r,t)=>{l[m][r]??=t};l[m]={result:!0,undo:class{[m]=[];#t;result=()=>{this.#t||(this[m].splice(0).map(r=>r()),this.#t=!0)};add(r){if(this.#t)return r();this[m].push(r)}until(){return this.#t}},live:class{[m]=new Map;result=new EventTarget;add(r,t){let e=this[m].get(r)??[];e.includes(t)||(e.push(t),this[m].set(r,e),l.ignore(()=>d(r).does(t)).then(()=>this.result.dispatchEvent(new CustomEvent("change"))))}}};var j=r=>{let t;return(...e)=>(t?.undo(),t=l(["undo"],()=>r(...e)),t.result)};var C=r=>{let t;return new w(e=>t=setInterval(e,r)).cleanup(()=>clearInterval(t))},q=r=>C(r).once(),A=()=>{let r;return new w(t=>{let e=()=>r=requestAnimationFrame(n=>{e(),t(n)});e()}).cleanup(()=>cancelAnimationFrame(r))},N=()=>{let r=0;return A().if(()=>r++).once()};var a=r=>{let t={x:new Set(["query","$"]),i:new WeakMap,s:class extends HTMLElement{constructor(){super(),t.i.set(this,{x:{}}),l.ignore(()=>o.constructor.call(this,t.i.get(this)))}}},e={};r(Object.fromEntries(a[m].map(([c,s])=>[s,(...i)=>(e[s]??=[]).push(i)])));let n=a[m].map(([c,s])=>c(t,e[s]??[])),o=k(n);return Object.entries(o).map(([c,s])=>t.s.prototype[c]??=function(...i){return l.ignore(()=>s.call(this,t.i.get(this),...i))}),customElements.define(t.p,t.s),customElements.whenDefined(t.p)};a[m]=[];a.register=(r,t,e)=>{a[m].push([e,t,r]),a[m].sort((n,o)=>n[2]-o[2])};a[h]=[];a.transform=(r,t)=>{a[h].push([t,r]),a[h].sort((e,n)=>e[1]-n[1])};var $=async r=>{if($[m].has(`${r}`))return;$[m].add(`${r}`);let t=await fetch(r),e=document.createElement("template");return e.innerHTML=await t.text(),a(n=>{for(let o of e.content.children)n[o.localName]?.(Object.fromEntries([...o.attributes].map(c=>[v(c.name),c.value])),o.innerHTML)})};$[m]=new Set;var F;$.auto=r=>{if($.auto[m])return;$.auto[m]=new Set;let t=n=>{if($.auto[m].has(n))return;$.auto[m].add(n);let o=r(n);o&&$(o)},e=n=>{for(let o of n.querySelectorAll(":not(:defined)"))t(o.localName);for(let o of n.querySelectorAll("template"))e(o.content)};return a.register(6,Symbol(),n=>F?{}:(n.l&&e(n.l),{}),{}),d(document).observes("mutation",{childList:!0,subtree:!0}).then(()=>e(document)).now().if(()=>null).cleanup(()=>F=!0)};a.register(0,"title",(r,[t])=>(r.p=t[1],{}));a.register(1,"meta",(r,t)=>{let e=t.filter(s=>s[0].attribute),n=[...t.filter(s=>s[0].property),...e.filter(s=>s[0].type).map(s=>[{property:s[0].as??v(s[0].attribute)}]),...t.filter(s=>s[0].method).map(s=>[{property:s[0].method,readonly:!0}])];return n.map(([s])=>{let i=function(){return l.ignore(()=>p.get(r.i.get(this).x.$,s.property))};Object.defineProperty(r.s.prototype,s.property,"readonly"in s?{get:i}:{get:i,set:function(u){l.ignore(()=>r.i.get(this).x.$[s.property]=u)}})}),r.s.observedAttributes=e.map(s=>s[0].attribute),r.s.formAssociated=t.some(s=>s[0].formAssociated!=null),{constructor:function(s){s.x.$=p({attributes:{}}),e.map(([i])=>{let u=v(i.attribute);if(s.x.$.$attributes[u]=null,d(s.x.$.$attributes[`$${u}`]).change().then(()=>{let f=p.get(s.x.$.$attributes,u);f==null?this.removeAttribute(i.attribute):this.setAttribute(i.attribute,f)}),i.type=="boolean")p.link(s.x.$[`$${i.as??u}`],{get:()=>p.get(s.x.$.$attributes,u)!=null,set:f=>s.x.$.$attributes[u]=f?"":null,changes:d(s.x.$.$attributes[`$${u}`]).change()});else if(i.type){let f=self[v(`-${i.type}`)];p.link(s.x.$[`$${i.as??u}`],{get:()=>f(p.get(s.x.$.$attributes,u)??i.default??""),set:y=>s.x.$.$attributes[u]=y==null?null:`${y}`,changes:d(s.x.$.$attributes[`$${u}`]).change()})}}),n.map(([{property:i}])=>{if(!Object.hasOwn(this,i))return;let u=this[i];delete this[i],this[i]=u})},attributeChangedCallback:function(s,i,u,f){s.x.$.$attributes[v(i)]=f}}});a.register(2,"meta",(r,t)=>k([...t,[{hook:"connected",unhook:"disconnected"}],[{hook:"disconnected"}]].map(e=>{let{hook:n,unhook:o}=e[0];if(!n)return{};r.x.add(n);let c=function(i){i.x[n]=u=>{let f=[new w().then((...y)=>{f[1]?.undo(),f[1]=l(["undo"],()=>u?.(...y))}).cleanup(()=>{f[1]?.undo(),i.x[n][m].delete(f)})];return i.x[n][m].add(f),i.x[n][h]&&queueMicrotask(()=>f[0].now(...i.x[n][h])),f[0]},i.x[n][m]=new Set},s=function(i,...u){i.x[n][h]=u;for(let f of i.x[n][m])f[0].now(...u)};return o?{constructor:c,[`${n}Callback`]:s,[`${o}Callback`]:function(i,...u){i.x[n][h]=null;for(let f of i.x[n][m])f[1]?.undo()}}:{constructor:c,[`${n}Callback`]:s}})));a.register(3,Symbol(),r=>({constructor:function(e){e.o=(n,...o)=>{let c=o.map(()=>`$${v(crypto.randomUUID())}`),s=new Function(...c,`var ${o.map((i,u)=>`${i[0]}=${c[u]}`)};return(${n})`);return(i,...u)=>s.call(i,...u.map(f=>f[1]))},e.f=(n,...o)=>{let c=n.cloneNode(!0),s=document.createNodeIterator(c,5),i;t:for(;i=s.nextNode();){if(i.nodeType==1){for(let[u]of a[h])for(let f of[...i.attributes])if(u(f,o,e,r),s.referenceNode!=i)continue t}for(let[u]of a[h])if(u(i,o,e,r),s.referenceNode!=i)continue t}return c}}}));a.register(5,"template",(r,[t])=>{if(!t)return{constructor:function(n){n.root=this}};let e=document.createElement("template");return e.innerHTML=t[1],r.l=e.content,t[0].mode?{constructor:function(n){n.root=this.attachShadow(t[0]),n.root.append(n.f(r.l,[`{${[...r.x]}}`,n.x])),customElements.upgrade(n.root)}}:{constructor:function(n){n.root=n.f(r.l,[`{${[...r.x]}}`,n.x]),customElements.upgrade(n.root)},connectedCallback:function(n){n.root!=this&&(this.replaceChildren(n.root),n.root=this)}}});a.register(7,Symbol(),r=>({constructor:function(e){e.x.query=n=>e.root.querySelector(n),e.x.query.all=n=>[...e.root.querySelectorAll(n)]}}));a.register(8,"style",(r,[t])=>{if(!t)return{};let e=new CSSStyleSheet;return e.replace(t[1]),{connectedCallback:function(n){let o=n.root.mode?n.root:this.getRootNode(),c=o.adoptedStyleSheets;c.includes(e)||(o.adoptedStyleSheets=[...c,e])}}});a.register(10,"script",(r,[t])=>{if(!t)return{};let e=new Function(`{${[...r.x]}}`,`const{${Object.keys(self.yozo)}}=self.yozo;${t[1]}`);return{constructor:function(n){e.call(this,n.x)}}});a.transform(0,(r,t,e,n)=>{if(r.nodeType!=3)return;let o=r.textContent.split(/{{([^]*?)}}/g);r.before(...o);let c=r;o.map((s,i)=>{if(c=c.previousSibling,i%2==0)return;let u=c,f=e.o(u.textContent,...t);e.x.connected(()=>g(()=>u.textContent=f(null,...t)))}),r.remove()});a.transform(1,(r,t,e,n)=>{if(r.nodeType!=2||r.name!="#for")return;let o=r.ownerElement;o.removeAttribute(r.name);let[c,s]=r.value.split(" of ");o.before("");let i=o.previousSibling;o.remove();let u=[],f=e.o(s,...t);e.x.connected(()=>g(()=>{let y=f(o,...t);for(;u.length>y.length;)u.pop()[1].map(b=>b.remove());let x=-1;for(let b of y){if(x++,u[x]&&u[x][0]===b)continue;let S=e.f(o.localName=="template"?o.content:o,...t,[c,b]);u[x]?.[1].map(T=>T.remove()),u[x]=[b,S.nodeType==11?[...S.childNodes]:[S]],(u[x-1]?.[1].at(-1)??i).after(...u[x][1])}}))});a.transform(2,(r,t,e,n)=>{if(r.nodeType!=2||r.name!="#if")return;r.ownerElement.before("");let o=r.ownerElement.previousSibling,c=[],s=[],i=o,u=b=>{if(i.nextElementSibling?.hasAttribute(b))return i=i.nextElementSibling,c.push(`()=>(${i.getAttribute(b)||!0})`),s.push(i.localName=="template"?i.content:i),i.removeAttribute(b),!0};for(u("#if");u("#else-if"););for(u("#else");o.nextSibling!=i;)o.nextSibling.remove();i.remove();let f,y=e.o(`[${c}].findIndex(e=>e())`,...t),x=[];e.x.connected(()=>g(()=>{let b=y(null,...t);if(b==f||(f=b,x.splice(0).map(T=>T.remove()),!s[b]))return;let S=e.f(s[b],...t);x.push(...S.nodeType==11?S.childNodes:[S]),o.after(...x)}))});a.transform(3,(r,t,e,n)=>{if(r.nodeType!=2||r.name[0]!=":")return;let o=r.ownerElement,c=r.name.slice(1);o.removeAttribute(r.name);let s=e.o(r.value,...t);e.x.connected(()=>g(()=>{let i=s(o,...t);i==null?o.removeAttribute(c):o.setAttribute(c,i)}))});a.transform(4,(r,t,e,n)=>{if(r.nodeType!=2||r.name[0]!=".")return;let o=r.ownerElement;o.removeAttribute(r.name);let c=r.name.slice(1).split(".").at(-1),s=r.name.slice(1).split(".").map(v),i=e.o(r.value||!0,...t);e.x.connected(()=>g(()=>{let u=i(o,...t),f=o,y=[...s],x=y.pop();for(let b of y)f=f?.[b];f!=null&&(f instanceof DOMTokenList?f.toggle(c,u):f[x]=u)}))});a.transform(5,(r,t,e,n)=>{if(r.nodeType!=2||r.name[0]!="@")return;let o=r.ownerElement,c=r.name.slice(1);o.removeAttribute(r.name);let s=e.o(r.value,...t,["event"]);e.x.connected(()=>d(o).does(c).then(i=>{l.ignore(()=>s(o,...t,["event",i]))}))});self.yozo={monitor:l,until:M,Flow:w,live:p,when:d,purify:j,effect:g,frame:A,interval:C,paint:N,timeout:q};Object.defineProperty(self.yozo,"register",{value:$});})();
