(()=>{var v=class{#e=[];#r=[];#n;#t;constructor(e){a.add("undo",()=>this.stop()),e?.((...t)=>{this.now(...t)})}pipe(e){return this.#e?.push(e),this}now(...e){let t=-1,r=()=>{this.#e&&(t++,!(t<this.#t)&&(this.#n&&(this.#t=t+1),this.#e.length+1==this.#t&&this.stop(),this.#e?.[t]?.(r,...e)))};return r(),this}then(e){return this.pipe((t,...r)=>{e(...r),t()})}await(e){return this.pipe(async(t,...r)=>{await e(...r),t()})}if(e){return this.pipe((t,...r)=>{e(...r)&&t()})}or(e){return e.then((...t)=>this.now(...t)),this.cleanup(()=>e.stop?.())}stop(){return this.#e&&this.#r.splice(0).map(e=>e()),this.#e=null,this}until(e){return typeof e=="function"?this.pipe((t,...r)=>e(...r)?this.stop():t()):(this.cleanup(()=>e.stop?.()),e.then(()=>this.stop()),this)}cleanup(e){return this.#e?this.#r.push(e):e(),this}once(){return this.then(()=>this.#n=!0)}debounce(e){let t;return this.pipe(r=>{clearTimeout(t),t=setTimeout(r,e)}).cleanup(()=>clearTimeout(t))}throttle(e){let t,r;return this.pipe(o=>{if(r)return t=o;o(),r=setInterval(()=>{if(!t){clearTimeout(r),r=0;return}t(),t=null},e)}).cleanup(()=>clearTimeout(r))}after(e){return queueMicrotask(()=>queueMicrotask(e)),this}};var k=n=>n.replace(/-+(\w?)/g,(e,t)=>t.toUpperCase()),L=n=>{let e={constructor:null};for(let t of n)for(let r of Object.keys(t))e[r]??=function(...o){n.map(c=>c[r]?.call(this,...o))};return e};var O=(...n)=>new Proxy({does:(e,t)=>{let r;return new v(o=>{r=o,n.map(c=>c.addEventListener(e,r,t))}).cleanup(()=>n.map(o=>o.removeEventListener(e,r,t)))},observes:(e,t)=>{let r;return new v(o=>{r=new self[k(`-${e}-observer`)](o,t),n.map(c=>r.observe(c,t))}).cleanup(()=>r.disconnect())}},{get:(e,t)=>e[t]??e.does.bind(null,t.replace(/s$/,""))});var M=(n,e=queueMicrotask)=>{let t,r=()=>e(()=>o.now()),o=new v().then(()=>{t?.undo(),t=a(["undo","live"],n),t.live.addEventListener("change",r,{once:!0})}).cleanup(()=>{t?.undo(),t?.live.removeEventListener("change",r,{once:!0})});return r(),o};var g=n=>new N({e:{$:g.get(n)}},"$").t,j=new WeakMap,N=class n{constructor(e,t,r=this){this.r=e,this.i=t,this.p=r,this.a={},this.t=new Proxy(new EventTarget,{get:(o,c)=>c==Symbol.iterator?()=>(a.add("live",this.t,"keychange"),[...this.e].map((s,l)=>this.n(l).t)[c]()):c[0]=="$"?this.n(c.slice(1)).t:o[c]?o[c].bind(o):(a.add("live",this.n(c).t,"deepchange"),this.e?.[c]),set:(o,c,s)=>g.set(this.n(c).t,s),deleteProperty:(o,c,s)=>g.delete(this.n(c).t),has:(o,c)=>(a.add("live",this.t,"keychange"),this.e!=null&&c in this.e||o[c]),ownKeys:()=>(a.add("live",this.t,"keychange"),Object.keys(this.e??{}).map(o=>`$${o}`)),getOwnPropertyDescriptor:()=>({configurable:!0,enumerable:!0}),defineProperty:()=>!1}),j.set(this.t,this),this.e=this.r.e?.[this.i],this.f=this.e instanceof Object?Object.keys(this.e??{}):[]}n(e){return this.a[e]??=new n(this,e,this.p)}c(e,t=new Set){let r=e?.(),o=this.e,c=this.e=this.r.e?.[this.i],s=this.e instanceof Object?Object.keys(this.e??{}):[],l=new Set(this.f);this.f=s;for(let u of s)l.has(u)?l.delete(u):l.add(u);if(l.size&&this.t.dispatchEvent(new CustomEvent("keychange",{detail:{keys:[...l]}})),Object.is(o,c))return r;this.t.dispatchEvent(new CustomEvent("change",{detail:{oldValue:o,value:c}}));let i=this;for(;!t.has(i)&&i.r;)i.c(null,t),t.add(i),i=i.r;for(let u of Object.values(this.a))u.c(null,t);if(e){for(let u of t)u.t.dispatchEvent(new CustomEvent("deepchange"));return r}}};g.get=(n,e)=>{let t=j.get(n);return t?e!=null?t.n(e).e:(a.add("live",n,"deepchange"),t.e):e==null?n:n[e]};g.set=(n,e)=>{let t=j.get(n);return!!t?.c(()=>t.r.e==null?!1:(t.r.e[t.i]=g.get(e),!0))};g.delete=(n,e)=>{let t=j.get(n);return!!t?.c(()=>t.r.e==null?!1:delete t.r.e[t.i])};g.link=(n,e)=>{let t,r=e;self.HTMLElement&&e instanceof HTMLElement?r={get:()=>e.value,set:i=>e.value=i,changes:O(e).input()}:typeof e=="function"&&(r={get:()=>t,changes:M(()=>t=e(),i=>i())});let o=new v;r.changes?.then(()=>o.now());let c,s=i=>{c=!0,g.set(n,i),t=i,c=!1},l=()=>{if(!c){if(!r.set)return s(t);r.set(a.ignore(()=>g.get(n))),s(a.ignore(r.get))}};return n.addEventListener("deepchange",l),s(a.ignore(r.get)),o.then(()=>s(a.ignore(r.get))).cleanup(()=>n.removeEventListener("deepchange",l))};var C,a=(n,e)=>{let t=C;C={};let r={};return n.map(o=>{C[o]=new V[o],r[o]=C[o].result}),r.result=e(),C=t,r},D=n=>C?new Promise(async e=>{let t=C,r=await n;Object.keys(t).some(o=>t[o].until?.())||(queueMicrotask(()=>C=t),e(r),queueMicrotask(()=>C=null))}):n;a.ignore=n=>a([],n).result;a.add=(n,...e)=>{C?.[n]?.add(...e)};a.register=(n,e)=>{V[n]??=e};var V={undo:class{#e=[];result=()=>{this.#e?.map(n=>n()),this.#e=null};add(n){return this.#e?.push(n)??n()}until(){return!this.#e}},live:class{#e=new Map;result=new EventTarget;add(n,e){let t=this.#e.get(n)??[];t.includes(e)||(t.push(e),this.#e.set(n,t),n.addEventListener(e,()=>this.result.dispatchEvent(new CustomEvent("change"))))}}};var R=n=>{let e;return(...t)=>(e?.undo(),e=a(["undo"],()=>n(...t)),e.result)};var I=n=>{let e;return new v(t=>e=setInterval(t,n)).cleanup(()=>clearInterval(e))},W=n=>I(n).once(),P=()=>{let n;return new v(e=>{let t=()=>n=requestAnimationFrame(r=>{t(),e(r)});t()}).cleanup(()=>cancelAnimationFrame(n))},K=()=>{let n=0;return P().if(()=>n++).once()};var w=n=>{let e={x:new Set(["query","$"]),o:new WeakMap,s:class extends HTMLElement{constructor(){super(),e.o.set(this,{x:{}}),a.ignore(()=>r.constructor.call(this,e.o.get(this)))}}},t={};n(Object.fromEntries(q.map(([o,c])=>[c,(...s)=>(t[c]??=[]).push(s)])));let r=L(q.map(([o,c])=>o(e,t[c]??[])));return Object.entries(r).map(([o,c])=>e.s.prototype[o]??=function(...s){return a.ignore(()=>c.call(this,e.o.get(this),...s))}),customElements.define(e.m,e.s),customElements.whenDefined(e.m)},q=[];w.register=(n,e,t)=>{q.push([t,e,n]),q.sort((r,o)=>r[2]-o[2])};var H=new Map,F=n=>(H.get(`${n}`)||H.set(`${n}`,fetch(n).then(async e=>{if(!e.ok)return;let t=document.createElement("template");return t.innerHTML=await e.text(),w(r=>{for(let o of t.content.children)r[o.localName]?.(Object.fromEntries([...o.attributes].map(c=>[k(c.name),c.value])),o.innerHTML)})})),H.get(`${n}`)),U=new Set,z;F.auto=n=>{if(z)return;z=n;let e=r=>{for(let o of r.querySelectorAll(":not(:defined)"))t(o.localName);for(let o of r.querySelectorAll("template"))e(o.content)},t=r=>{if(U.has(r))return;U.add(r);let o=z(r);o&&F(o)};w.register(6,Symbol(),r=>(r.u&&e(r.u),{})),document.readyState=="loading"?document.addEventListener("readystatechange",()=>e(document),{once:!0}):e(document)};w.register(0,"title",(n,[e])=>(n.m=e[1],{}));w.register(1,"meta",(n,e)=>{let t=e.filter(s=>s[0].attribute),r=[...e.filter(s=>s[0].property),...t.filter(s=>s[0].type).map(s=>[{property:s[0].as??k(s[0].attribute)}]),...e.filter(s=>s[0].method).map(s=>[{property:s[0].method,readonly:!0}])];return r.map(([s])=>{let l=function(){return a.ignore(()=>g.get(n.o.get(this).x.$,s.property))};Object.defineProperty(n.s.prototype,s.property,"readonly"in s?{get:l}:{get:l,set:function(i){n.o.get(this).x.$[s.property]=i}})}),n.s.observedAttributes=t.map(s=>s[0].attribute),n.s.formAssociated=e.some(s=>s[0].formAssociated!=null),{constructor:function(s){s.x.$=g({attributes:{}}),t.map(([l])=>{let i=k(l.attribute);if(s.x.$.$attributes[i]=null,s.x.$.$attributes[`$${i}`].addEventListener("change",()=>{let u=g.get(s.x.$.$attributes,i);this.getAttribute(i)!=u&&(u==null?this.removeAttribute(l.attribute):this.setAttribute(l.attribute,u))}),l.type=="boolean")g.link(s.x.$[`$${l.as??i}`],{get:()=>g.get(s.x.$.$attributes,i)!=null,set:u=>s.x.$.$attributes[i]=u?"":null,changes:O(s.x.$.$attributes[`$${i}`]).change()});else if(l.type){let u=self[k(`-${l.type}`)];g.link(s.x.$[`$${l.as??i}`],{get:()=>u(g.get(s.x.$.$attributes,i)??l.default??""),set:f=>s.x.$.$attributes[i]=f==null?null:`${f}`,changes:O(s.x.$.$attributes[`$${i}`]).change()})}}),r.map(([{property:l}])=>{if(!Object.hasOwn(this,l))return;let i=this[l];delete this[l],this[l]=i})},attributeChangedCallback:function(s,l,i,u){s.x.$.$attributes[k(l)]=u}}});w.register(2,"meta",(n,e)=>L([...e,[{hook:"connected",unhook:"disconnected"}],[{hook:"disconnected"}]].map(t=>{let{hook:r,unhook:o}=t[0];if(!r)return{};let c=Symbol(),s=Symbol();n.x.add(r);let l=function(u){u.x[r]=f=>{let m=[new v().then((...p)=>{m[1]?.undo(),m[1]=a(["undo"],()=>f?.(...p))}).cleanup(()=>{m[1]?.undo(),u[c].delete(m)})];return u[c].add(m),u[s]&&queueMicrotask(()=>m[0].now(...u[s])),m[0]},u[c]=new Set},i=function(u,...f){u[s]=f;for(let m of u[c])m[0].now(...f)};return o?{constructor:l,[`${r}Callback`]:i,[`${o}Callback`]:function(u,...f){u[s]=null;for(let m of u[c])m[1]?.undo()}}:{constructor:l,[`${r}Callback`]:i}})));w.register(3,Symbol(),n=>{let e=new Map,t=(o,...c)=>{if(e.get(o))return e.get(o);let s=[];e.set(o,s);let l=document.createNodeIterator(o,5),i;for(;i=l.nextNode();)if(i.nodeType==3){let u=i.textContent.split(/{{([^]*?)}}/g);i.after(...u),i.remove(),s.push(...u.map((f,m)=>{if(i=l.nextNode(),m%2==0)return;let p=new Function(...c,`return(${f})`);return(S,b,d)=>M(()=>{b.textContent=p(...d.map(h=>h[1]))})}))}else if(i.getAttribute("#for")){let[u,f]=i.getAttribute("#for").split(" of ");i.before(""),i.removeAttribute("#for"),i.remove();let m=i.localName=="template"?i.content:i,p=new Function(...c,`return(${f})`);s.push((S,b,d)=>{let h=[];a.add("undo",()=>h.splice(0).map(x=>x[1].undo())),M(()=>{let x=[...p(...d.map(y=>y[1]))];for(;h.length>x.length;)h.pop()[1].undo();x.map((y,A)=>{h[A]&&h[A][0]===y||(h[A]?.[1].undo(),h[A]=[y,a(["undo"],()=>{let $=S.l(m,[...d,[u,y]]),E=$.nodeType==11?[...$.childNodes]:[$];return a.add("undo",()=>E.map(T=>T.remove())),(h[A-1]?.[1].result.at(-1)??b).after(...E),E})])})})})}else if(i.getAttribute("#if")){i.before("");let u=i.previousSibling,f=[],m=[],p=b=>{let d=u.nextElementSibling;if(d?.hasAttribute(b)){for(;u.nextSibling!=d;)u.nextSibling.remove();return f.push(`()=>(${d.getAttribute(b)||!0})`),m.push(d.localName=="template"?d.content:d),d.removeAttribute(b),d.remove(),!0}};for(p("#if");p("#else-if"););p("#else");let S=new Function(...c,`return[${f}].findIndex(e=>e())`);s.push((b,d,h)=>{let x,y,A=[];a.add("undo",()=>x?.undo()),M(()=>{let $=S(...h.map(E=>E[1]));$!=y&&(x?.undo(),y=$,m[$]&&(x=a(["undo"],()=>{let E=b.l(m[$],h),T=E.nodeType==11?E.childNodes:[E];a.add("undo",()=>A.splice(0).map(B=>B.remove())),A.push(...T),d.after(...T)})))})})}else{let u=[...i.attributes].map(f=>{if(f.name[0]==":"){let m=f.name.slice(1),p=new Function(...c,`return(${f.value})`);return i.removeAttribute(f.name),(S,b,d)=>M(()=>{let h=p.call(b,...d.map(x=>x[1]));h==null?b.removeAttribute(m):b.setAttribute(m,h)})}else if(f.name[0]=="."){let m=f.name.slice(1).split(".").at(-1),p=f.name.slice(1).split(".").map(k),S=new Function(...c,`return(${f.value})`);return i.removeAttribute(f.name),(b,d,h)=>M(()=>{let x=S.call(d,...h.map(E=>E[1])),y=[...p],A=y.pop(),$=d;y.map(E=>$=$?.[E]),$!=null&&($ instanceof DOMTokenList?$.toggle(m,x):$[A]=x)})}else if(f.name[0]=="@"){let m=f.name.slice(1),p=new Function(...c,"event",f.value);return i.removeAttribute(f.name),(S,b,d)=>{let h=x=>a.ignore(()=>p.call(b,...d.map(y=>y[1]),x));b.addEventListener(m,h),a.add("undo",()=>b.removeEventListener(m,h))}}});s.push((...f)=>{u.map(m=>m?.(...f))})}return s};return{constructor:function(o){o.l=(c,s,l=i=>i())=>{let i=t(c,...s.map(p=>p[0])),u=c.cloneNode(!0),f=document.createNodeIterator(u,5),m=i.map(p=>[f.nextNode(),p]).filter(([p,S])=>S);return l(()=>{m.map(p=>p[1](o,p[0],s))}),u}}}});w.register(5,"template",(n,[e])=>{if(!e)return{constructor:function(r){r.root=this}};let t=document.createElement("template");return t.innerHTML=e[1],n.u=t.content,e[0].mode?{constructor:function(r){r.root=this.attachShadow(e[0]),r.root.append(r.l(n.u,[[`{${[...n.x]}}`,r.x]],r.x.connected)),customElements.upgrade(r.root)}}:{constructor:function(r){r.root=r.l(n.u,[[`{${[...n.x]}}`,r.x]],r.x.connected),customElements.upgrade(r.root)},connectedCallback:function(r){r.root!=this&&(this.replaceChildren(r.root),r.root=this)}}});w.register(7,Symbol(),n=>({constructor:function(t){t.x.query=r=>t.root.querySelector(r),t.x.query.all=r=>[...t.root.querySelectorAll(r)]}}));w.register(8,"style",(n,[e])=>{if(!e)return{};let t=new CSSStyleSheet;return t.replace(e[1]),{connectedCallback:function(r){let o=r.root.mode?r.root:this.getRootNode(),c=o.adoptedStyleSheets;c.includes(t)||(o.adoptedStyleSheets=[...c,t])}}});w.register(10,"script",(n,[e])=>{if(!e)return{};let t=new Function(`{${[...n.x]}}`,`const{${Object.keys(self.yozo)}}=self.yozo;${e[1]}`);return{constructor:function(r){t.call(this,r.x)}}});self.yozo={monitor:a,until:D,Flow:v,live:g,when:O,purify:R,effect:M,frame:P,interval:I,paint:K,timeout:W};Object.defineProperty(self.yozo,"register",{value:F});})();
