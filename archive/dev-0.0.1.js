// Yozo version: 0.0.1
(()=>{var C=(e=console.log,t)=>(r,...n)=>{let o=String.raw(r,...n),i=String.raw(r,...n.map((a,u)=>`$${u+1}`));if(t&&C.memory.has(o))return;C.memory.add(o);let c=W[i](...n).replaceAll(/^\s+/gm,"").trim();t&&(c+=`
`+t),e(c)};C.memory=new Set;var k=C(e=>{throw new Error(e)}),w=C(e=>console.warn(e)),U=C(e=>console.warn(e),"Warnings after this one will be suppressed"),W={"when-arg-not-event-target":()=>`
		Could not attach event listener(s) with when(\u2026);
		Not all of its arguments were EventTargets.`,"when-cannot-observe-$1-no-$2":(e,t)=>`
		Failed at when(\u2026).observe('${e}').
		This occurred because "${t}Observer" doesn't exist.`,"when-$1-instead-of-$2-mistake":(e,t)=>`
		when(\u2026).{property}() may be a mistake, as it listens to the "${t}" event.
		If you want to listen to the "${e}" event, use .does('${e}').`,"track-add-$1-not-in-registry":e=>`
		An item was added to "${e}", but "${e}" was not registered.
		Register it first using track.register('${e}', class { \u2026 }).`,"track-cannot-register-result":()=>`
		"result" cannot be registered as a trackable.
		Tracked calls already store their result under this key.`,"track-registry-already-has-$1":e=>`
		track.register('${e}', \u2026) was called, but "${e}" was already registerd.
		You cannot overwrite an existing registration; re-registrations are ignored.`,"track-shorthand-$1-not-created":e=>`
		Registered the trackable "${e}", but could not create the shorthand.
		track.${e} already exists; instead, use track(['${e}'], () => \u2026).`,"track-$1-definition-must-be-class":e=>`
		Registering "${e}", but its definition was not a class.
		Register it using track.register('${e}', class { \u2026 }).`,"flow-stopped-but-triggered":()=>`
		A flow was triggered after it stopped. Often, this indicates a memory leak.
		Make sure you use .cleanup(\u2026) to undo everything triggering the flow.`,"live-$1-on-non-live":e=>`
		live.${e}(\u2026) was called, but its first argument wasn't live.
		This was probably a mistake; it does nothing.`,"live-link-target-$1-not-live":e=>`
		Something non-live was passed to live.link(\u2026).
		Probably, you missed the $ in .$${e}.`,"live-link-target-not-live":()=>`
		Something non-live was passed to live.link(\u2026).
		Make sure its first argument is a live variable.`,"live-property-$1-doubled":e=>`
		Objects with (nested) live properties should not be live themselves.
		Now .${e} is live and .$${e} is double-live, which is confusing.`,"live-property-set-$1-has-$":e=>`
		The "${e}" property was set, which may have been unintentional.
		To set the "${e.slice(1)}" property instead, use $object.${e.slice(1)} = \u2026.`,"live-property-delete-$1-has-$":e=>`
		The "${e}" property was deleted, which may have been unintentional.
		To delete the "${e.slice(1)}" property, use delete $object.${e.slice(1)}.`,"define-missing-title":()=>`
		Component definition is missing <title>\u2026</title>.
		This is required, as it determines the component's tag name.`,"define-attribute-$1-type-$2-does-not-exist":(e,t)=>`
		Attribute "${e}" defined type "${t}", but that doesn't exist.
		The type attribute is converted to PascalCase, and that must be a global.`,"transform-for-$1-not-iterable":e=>`
		Expression "${e}" in #for is not iterable.`,"transform-if-found-loose-$1":e=>`
		Found an "${e}" attribute without an #if.
		Make sure the element follows an element with an #if or #else-if.`};var h=Symbol(),m=Symbol(),A=()=>`_${y(crypto.randomUUID())}`,y=e=>e.replace(/-+(\w)?/g,(t,r="")=>r?.toUpperCase()),q=e=>e.replace(/[A-Z]/g,"-$&").toLowerCase(),M=e=>{let t={constructor:null};for(let r of e)for(let n of Object.keys(r))t[n]??=function(...o){e.map(i=>i[n]?.call(this,...o))};return t};var b=class{#e=[];#n=[];#t;#o;#r;constructor(t){l.add("undo",()=>this.stop()),t?.((...r)=>{this.#t&&w`flow-stopped-but-triggered`,this.now(...r)})}flow(t){return this.#e.push(t),this}now(...t){let r=-1,n=()=>{this.#t||(r++,!(r<this.#r)&&(this.#o&&(this.#r=r+1),this.#e.length+1==this.#r&&this.stop(),this.#e[r]?.(n,...t)))};return n(),this}then(t){return this.flow((r,...n)=>{t(...n),r()})}if(t){return this.flow((r,...n)=>{t(...n)&&r()})}or(t){return t.then((...r)=>this.now(...r)),this.cleanup(()=>t.stop?.())}stop(){if(!this.#t)return this.#t=!0,this.#e.splice(0),this.#n.splice(0).map(t=>t()),this}until(t){return typeof t=="function"?this.flow((r,...n)=>t(...n)?this.stop():r()):(this.cleanup(()=>t.stop?.()),t.then(()=>this.stop()),this)}cleanup(t){return this.#t?t():this.#n.push(t),this}once(){return this.then(()=>this.#o=!0)}debounce(t){let r;return this.flow(n=>{clearTimeout(r),r=setTimeout(n,t)}).cleanup(()=>clearTimeout(r))}throttle(t){let r,n;return this.flow(o=>{if(n)return r=o;o(),n=setInterval(()=>{if(!r){clearTimeout(n),n=0;return}r(),r=null},t)}).cleanup(()=>clearTimeout(n))}after(t){return queueMicrotask(()=>queueMicrotask(t)),this}};var d=(...e)=>new Proxy({does:(t,r)=>{let n;return new b(o=>{n=o,e.every(i=>typeof i?.addEventListener=="function")||k`when-arg-not-event-target`,e.map(i=>i.addEventListener(t,n,r))}).cleanup(()=>e.map(o=>o.removeEventListener(t,n,r)))},observes:(t,r)=>{let n;return new b(o=>{let i=y(`-${t}-observer`);typeof self[i]!="function"&&k`when-cannot-observe-${t}-no-${i}`,n=new self[y(`-${t}-observer`)](o,r),e.map(s=>n.observe(s,r))}).cleanup(()=>n.disconnect())}},{get:(t,r)=>{let n=r.replace(/s$/,"");return!t[r]&&n!=r&&"on"+r in self&&w`when-${r}-instead-of-${n}-mistake`,t[r]??t.does.bind(null,r.replace(/s$/,""))}});var $=(e,t=queueMicrotask,r)=>{let n,o=new b;return o.then(()=>{let i=l(["live","undo"],e);n=l.ignore(()=>d(i.live).change()).once().then(()=>t(()=>o.now())).cleanup(()=>i.undo())}).cleanup(()=>n?.stop()),t(()=>o.now()),o};var p=e=>new O({e:{$:p.get(e)}},"$").t;p[m]=new WeakMap;var P=new WeakMap,E=async e=>{E.recent=e,await"mircrotask",E.recent=null},O=class{constructor(t,r,n=this){this.r=t,this.i=r,this.h=n,this.m={},this.t=new Proxy(new EventTarget,{get:(o,i)=>i==Symbol.iterator?(E(i),()=>(l.add("live",this.t,"keychange"),[...this.e].map((s,c)=>this.n(c).t)[Symbol.iterator]())):i[0]=="$"?this.n(i.slice(1)).t:(E(i),o[i]?o[i].bind(o):(l.add("live",this.n(i).t,"deepchange"),this.e?.[i])),set:(o,i,s)=>(i[0]=="$"&&w`live-property-set-${i}-has-$`,p.set(this.n(i).t,s)),deleteProperty:(o,i,s)=>(i[0]=="$"&&w`live-property-delete-${i}-has-$`,p.delete(this.n(i).t)),has:(o,i)=>(l.add("live",this.t,"keychange"),this.e!=null&&o[i]||i in this.e),ownKeys:()=>(l.add("live",this.t,"keychange"),Object.keys(this.e??{}).map(o=>`$${o}`)),getOwnPropertyDescriptor:()=>({configurable:!0,enumerable:!0}),defineProperty:()=>!1}),p[m].set(this.t,this),n==this&&P.set(this,new Set),P.get(n).add(new WeakRef(this)),this.e=this.r.e?.[this.i],this.p=Object.keys(this.e??{})}n(t){return this.m[t]??=new O(this,t,this.h)}l(t,r=new Set([this])){let n=t?.(),o=this.e,i=this.r.e?.[this.i];this.e=i,Object.is(o,i)||this.t.dispatchEvent(new CustomEvent("change",{detail:{oldValue:o,value:i}}));let s=Object.keys(this.e??{}),c=new Set(this.p);this.p=s;for(let u of s)c.has(u)?c.delete(u):c.add(u);c.size&&this.t.dispatchEvent(new CustomEvent("keychange",{detail:{keys:[...c]}}));let a=this.r;for(r.add(this);!r.has(a)&&a.r;)a.l(null,r),r.add(a),a=a.r;if(Object.is(o,i))return n;for(let u of Object.values(this.m))u.l(null,r);if(t){for(let u of r)u.t.dispatchEvent(new CustomEvent("deepchange"));return n}}};p.get=(e,t)=>{let r=p[m].get(e);return r?(E(t??r.i),t!=null?r.n(t).e:(l.add("live",e,"deepchange"),r.e)):t==null?e:e[t]};p.set=(e,t)=>{let r=p[m].get(e);return!!r?.l(()=>r.r.e==null?!1:(r.r.e[r.i]=p.get(t),!0))};p.delete=(e,t)=>{let r=p[m].get(e);return!!r?.l(()=>r.r.e==null?!1:delete r.r.e[r.i])};p.link=(e,t)=>{p[m].has(e)||(E.recent?k`live-link-target-${E.recent}-not-live`:k`live-link-target-not-live`);let r,n=t;t instanceof HTMLElement?n={get:()=>t.value,set:c=>t.value=c,changes:d(t).input()}:typeof t=="function"&&(n={get:()=>r,changes:$(()=>r=t(),c=>c())});let o,i=c=>{o=!0,p.set(e,c),r=c,o=!1},s=d(e).deepchange().then(()=>{if(!o){if(!n.set)return i(r);n.set(l.ignore(()=>p.get(e))),i(l.ignore(n.get))}});return i(l.ignore(n.get)),(n.changes??new b).then(()=>i(l.ignore(n.get))).if(()=>null).cleanup(()=>s.stop())};var l=(e,t)=>{let r=l[h];l[h]={};let n={};for(let o of e)n[o]=(l[h][o]=new l[m][o]).result;return n.result=t(),l[h]=r,n},L=e=>{if(!l[h])return e;let t=l[h];return l[h]=null,{then:r=>Promise.resolve(e).then(n=>{Object.keys(t).some(o=>t[o].until?.())||(queueMicrotask(()=>l[h]=t),r(n),queueMicrotask(()=>l[h]=null))})}};l.ignore=e=>l([],e).result;l.add=(e,...t)=>{l[m][e]||w`track-add-${e}-not-in-registry`,l[h]?.[e]?.add(...t)};l[m]={result:!0};l.register=(e,t)=>{e=="result"&&w`track-cannot-register-result`,l[m][e]&&w`track-registry-already-has-${e}`,!l[m][e]&&(l[e]&&w`track-shorthand-${e}-not-created`,l[m][e]??=t,l[e]??=r=>l([e],r))};l.register("undo",class{[m]=[];#e;result=()=>{this.#e||(this[m].splice(0).map(e=>e()),this.#e=!0)};add(e){if(this.#e)return e();this[m].push(e)}until(){return this.#e}});l.register("live",class{[m]=new Map;result=new EventTarget;add(e,t){let r=this[m].get(e)??[];r.includes(t)||(r.push(t),this[m].set(e,r),l.ignore(()=>d(e).does(t)).then(()=>this.result.dispatchEvent(new CustomEvent("change"))))}});var I=e=>{let t;return(...r)=>(t?.undo(),t=l.undo(()=>e(...r)),t.result)};var F=e=>{let t;return new b(r=>t=setInterval(r,e)).cleanup(()=>clearInterval(t))},z=e=>F(e).once(),R=()=>{let e;return new b(t=>{let r=()=>e=requestAnimationFrame(n=>{r(),t(n)});r()}).cleanup(()=>cancelAnimationFrame(e))},D=()=>{let e=0;return R().if(()=>e++).once()};var f=e=>{let t={x:new Set,s:new WeakMap,c:class extends HTMLElement{constructor(){super(),t.s.set(this,{x:{}}),l.ignore(()=>o.constructor.call(this,t.s.get(this)))}}},r={};e(Object.fromEntries(f[m].map(([i,s])=>[s,(...c)=>(r[s]??=[]).push(c)])));let n=f[m].map(([i,s])=>i(t,r[s]??[])),o=M(n);for(let i of Object.keys(o))t.c.prototype[i]??=function(...s){l.ignore(()=>o[i].call(this,t.s.get(this),...s))};return t.f||k`define-missing-title`,customElements.define(t.f,t.c),customElements.whenDefined(t.f)};f[m]=[];f[h]=[];f.register=(e,t,r)=>{f[m].push([r,t,e]),f[m].sort((n,o)=>n[2]-o[2])};f.transform=(e,t)=>{f[h].push([t,e]),f[h].sort((r,n)=>r[1]-n[1])};var T=async e=>{if(T[m].has(e))return;T[m].add(e);let t=await fetch(e);if(!t.ok)return;let r=A(),n=A(),o=document.createElement("template");return o.innerHTML=await t.text(),f(i=>{for(let s of o.content.children)i[s.localName]?.(Object.fromEntries([...s.attributes].map(c=>[y(c.name),c.value])),s.innerHTML)})};T[m]=new Set;var N,H;T.auto=e=>{if(N)return;N=new Set;let t=n=>{if(N.has(n))return;N.add(n);let o=e(n);o&&T(o)},r=n=>{for(let o of n.querySelectorAll(":not(:defined)"))t(o.localName);for(let o of n.querySelectorAll("template"))r(o.content)};return f.register(6,null,n=>H?{}:n.a?(r(n.a),{}):{},{}),d(document).observes("mutation",{childList:!0,subtree:!0}).then(()=>r(document)).now().if(()=>null).cleanup(()=>H=!0)};f.register(0,"title",(e,[t])=>(e.f=t?.[1],{}));f.register(1,"meta",(e,t)=>{e.x.add("$");let r=t.filter(s=>s[0].attribute),n=[...t.filter(s=>s[0].property),...r.filter(s=>s[0].type).map(s=>[{property:s[0].as??y(s[0].attribute)}]),...t.filter(s=>s[0].method).map(s=>[{property:s[0].method,readonly:""}])];for(let[s]of n){let c=function(){return l.ignore(()=>p.get(e.s.get(this).x.$,s.property))},a=function(u){l.ignore(()=>e.s.get(this).x.$[s.property]=u)};Object.defineProperty(e.c.prototype,s.property,"readonly"in s?{get:c}:{get:c,set:a})}return e.c.observedAttributes=r.map(s=>s[0].attribute),e.c.formAssociated=t.some(s=>s[0].formAssociated!=null),{constructor:function(s){s.x.$=p({attributes:{}}),s.x.$.attributes={};for(let[c]of r){let a=y(c.attribute);if(s.x.$.$attributes[a]=null,d(s.x.$.$attributes[`$${a}`]).change().then(()=>{let u=p.get(s.x.$.$attributes,a);u==null?this.removeAttribute(c.attribute):this.setAttribute(c.attribute,u)}),c.type=="boolean")p.link(s.x.$[`$${c.as??a}`],{get:()=>p.get(s.x.$.$attributes,a)!=null,set:u=>s.x.$.$attributes[a]=u?"":null,changes:d(s.x.$.$attributes[`$${a}`]).change()});else if(c.type){let u=self[y(`-${c.type}`)];u||k`define-attribute-${c.attribute}-type-${u}-does-not-exist`,p.link(s.x.$[`$${c.as??a}`],{get:()=>u(p.get(s.x.$.$attributes,a)??c.default??""),set:v=>s.x.$.$attributes[a]=v==null?null:`${v}`,changes:d(s.x.$.$attributes[`$${a}`]).change()})}}for(let[{property:c}]of n){if(!Object.hasOwn(this,c))continue;let a=this[c];delete this[c],this[c]=a}},attributeChangedCallback:function(s,c,a,u){s.x.$.$attributes[y(c)]=u}}});f.register(2,"meta",(e,t)=>{e.hook=(n,o)=>{let i=function(c){c.x[n]=a=>{let u=[new b().then((...v)=>{u[1]?.undo(),u[1]=l.undo(()=>a?.(...v))}).cleanup(()=>{u[1]?.undo(),c.x[n][m].delete(u)})];return c.x[n][m].add(u),c.x[n][h]&&queueMicrotask(()=>u[0].now(...c.x[n][h])),u[0]},c.x[n][m]=new Set},s=function(c,...a){c.x[n][h]=a;for(let u of c.x[n][m])u[0].now(...a)};return o?{constructor:i,[`${n}Callback`]:s,[`${o}Callback`]:function(c,...a){c.x[n][h]=null;for(let u of c.x[n][m])u[1]?.undo()}}:{constructor:i,[`${n}Callback`]:s}};let r=[...t,[{hook:"connected",unhook:"disconnected"}],[{hook:"disconnected"}]];return r.filter(n=>n[0].hook).map(n=>e.x.add(n[0].hook)),M(r.filter(n=>n[0].hook).map(n=>e.hook(n[0].hook,n[0].unhook)))});f.register(3,Symbol(),e=>({constructor:function(r){r.o=(n,...o)=>{let i=o.map(()=>A()),s=new Function(...i,`var ${o.map((c,a)=>`${c[0]}=${i[a]}`)};return(${n})`);return(c,...a)=>s.call(c,...a.map(u=>u[1]))},r.u=(n,...o)=>l.ignore(()=>{let i=n.cloneNode(!0),s=document.createNodeIterator(i,5),c;e:for(;c=s.nextNode();){if(c.nodeType==1){for(let[a]of f[h])for(let u of[...c.attributes])if(a(u,o,r,e),s.referenceNode!=c)continue e}for(let[a]of f[h])if(a(c,o,r,e),s.referenceNode!=c)continue e}return i})}}));f.register(5,"template",(e,[t])=>{if(!t)return{constructor:function(s){s.root=this}};let r=document.createElement("template");return r.innerHTML=t[1],e.a=r.content,t[0].mode?{constructor:function(s){s.root=this.attachShadow(t[0]),s.root.append(s.u(e.a,[`{${[...e.x]}}`,s.x])),customElements.upgrade(s.root)}}:{constructor:function(i){i.root=i.u(e.a,[`{${[...e.x]}}`,i.x]),customElements.upgrade(i.root)},connectedCallback:function(i){this.replaceChildren(i.root),i.root=this}}});f.register(7,Symbol(),e=>(e.x.add("elements"),{constructor:function(r){let n={all:o=>[...r.root.querySelectorAll(o)],shadow:r.root.mode?r.root:null};r.x.elements=new Proxy(o=>r.root.querySelector(o),{get:(o,i)=>n[i]??=o(`#${q(i)},#${i}`)??o(q(i))})}}));f.register(8,"style",(e,[t])=>{if(!t)return{};let r=new CSSStyleSheet;return r.replace(t[1]),{connectedCallback:function(o){let i=o.x.elements.shadow??this.getRootNode(),s=i.adoptedStyleSheets;s.includes(r)||(i.adoptedStyleSheets=[...s,r])}}});f.register(10,"script",(e,[t])=>{if(!t)return{};let r=new Function(`{${[...e.x]}}`,`const{${Object.keys(self.yozo)}}=self.yozo;${t[1]}`);return{constructor:function(o){r.call(this,o.x)}}});f.transform(0,(e,t,r,n)=>{if(e.nodeType!=3)return;let o=e.textContent.split(/{{([^]*?)}}/g);e.before(...o);let i=e;for(let s=1;s<o.length;s+=2){i=i.previousSibling.previousSibling;let c=i,a=r.o(c.textContent,...t);r.x.connected(()=>$(()=>{c.textContent=a(null,...t)}))}e.remove()});f.transform(1,(e,t,r,n)=>{if(e.nodeType!=2||e.name!="#for")return;let o=e.ownerElement;o.removeAttribute(e.name);let[i,s]=e.value.split(" of ");o.before("");let c=o.previousSibling;o.remove();let a=[],u=r.o(s,...t);r.x.connected(()=>$(()=>{let v=u(o,...t);for(typeof v?.[Symbol.iterator]!="function"&&k`transform-for-${s}-not-iterable`;a.length>v.length;)a.pop()[1].map(g=>g.remove());let x=-1;for(let g of v){if(x++,a[x]&&a[x][0]===g)continue;let S=r.u(o.localName=="template"?o.content:o,...t,[i,g]);a[x]?.[1].map(j=>j.remove()),a[x]=[g,S.nodeType==11?[...S.childNodes]:[S]],(a[x-1]?.[1].at(-1)??c).after(...a[x][1])}}))});f.transform(2,(e,t,r,n)=>{if(e.nodeType!=2||((e.name=="#else-if"||e.name=="#else")&&w`transform-if-found-loose-${e.name}`,e.name!="#if"))return;e.ownerElement.before("");let o=e.ownerElement.previousSibling,i=[],s=[],c=o,a=g=>{if(c.nextElementSibling?.hasAttribute(g))return c=c.nextElementSibling,i.push(`()=>(${c.getAttribute(g)})`),s.push(c.localName=="template"?c.content:c),c.removeAttribute(g),!0};for(a("#if");a("#else-if"););for(a("#else")&&(i[i.length-1]="()=>1");o.nextSibling!=c;)o.nextSibling.remove();c.remove();let u,v=r.o(`[${i}].findIndex(e=>e())`,...t),x=[];r.x.connected(()=>$(()=>{let g=v(null,...t);if(g==u||(u=g,x.splice(0).map(j=>j.remove()),!s[g]))return;let S=r.u(s[g],...t);x.push(...S.nodeType==11?S.childNodes:[S]),o.after(...x)}))});f.transform(3,(e,t,r,n)=>{if(e.nodeType!=2||e.name[0]!=":")return;let o=e.ownerElement,i=e.name.slice(1);o.removeAttribute(e.name);let s=r.o(e.value,...t);r.x.connected(()=>$(()=>{let c=s(o,...t);c==null?o.removeAttribute(i):o.setAttribute(i,c)}))});f.transform(4,(e,t,r,n)=>{if(e.nodeType!=2||e.name[0]!=".")return;let o=e.ownerElement;o.removeAttribute(e.name);let i=e.name.slice(1).split(".").at(-1),s=e.name.slice(1).split(".").map(y),c=r.o(e.value||!0,...t);r.x.connected(()=>$(()=>{let a=c(o,...t),u=o,v=[...s],x=v.pop();for(let g of v)u=u?.[g];u instanceof DOMTokenList?u.toggle(i,a):u!=null&&(u[x]=a)}))});f.transform(5,(e,t,r,n)=>{if(e.nodeType!=2||e.name[0]!="@")return;let o=e.ownerElement,i=e.name.slice(1);o.removeAttribute(e.name);let s=r.o(e.value,...t,["event"]);r.x.connected(()=>{d(o).does(i).then(c=>{l.ignore(()=>s(o,...t,["event",c]))})})});self.yozo={track:l,until:L,Flow:b,live:p,when:d,purify:I,effect:$,frame:R,interval:F,paint:D,timeout:z};Object.defineProperty(self.yozo,"register",{value:T});})();
