(()=>{var v=Symbol(),p=Symbol(),C=n=>n.replace(/-+(\w?)/g,(t,r)=>r.toUpperCase()),I=n=>{let t={constructor:null};for(let r of n)for(let e of Object.keys(r))t[e]??=function(...o){n.map(i=>i[e]?.call(this,...o))};return t};var $=class{#t=[];#n=[];#e;#o;#r;constructor(t){l.add("undo",()=>this.stop()),t?.((...r)=>{this.now(...r)})}flow(t){return this.#t.push(t),this}now(...t){let r=-1,e=()=>{this.#e||(r++,!(r<this.#r)&&(this.#o&&(this.#r=r+1),this.#t.length+1==this.#r&&this.stop(),this.#t[r]?.(e,...t)))};return e(),this}then(t){return this.flow((r,...e)=>{t(...e),r()})}await(t){return this.flow(async(r,...e)=>{await t(...e),r()})}if(t){return this.flow((r,...e)=>{t(...e)&&r()})}or(t){return t.then((...r)=>this.now(...r)),this.cleanup(()=>t.stop?.())}stop(){if(!this.#e)return this.#e=!0,this.#t.splice(0),this.#n.splice(0).map(t=>t()),this}until(t){return typeof t=="function"?this.flow((r,...e)=>t(...e)?this.stop():r()):(this.cleanup(()=>t.stop?.()),t.then(()=>this.stop()),this)}cleanup(t){return this.#e?t():this.#n.push(t),this}once(){return this.then(()=>this.#o=!0)}debounce(t){let r;return this.flow(e=>{clearTimeout(r),r=setTimeout(e,t)}).cleanup(()=>clearTimeout(r))}throttle(t){let r,e;return this.flow(o=>{if(e)return r=o;o(),e=setInterval(()=>{if(!r){clearTimeout(e),e=0;return}r(),r=null},t)}).cleanup(()=>clearTimeout(e))}after(t){return queueMicrotask(()=>queueMicrotask(t)),this}};var x=(...n)=>new Proxy({does:(t,r)=>{let e;return new $(o=>{e=o,n.map(i=>i.addEventListener(t,e,r))}).cleanup(()=>n.map(o=>o.removeEventListener(t,e,r)))},observes:(t,r)=>{let e;return new $(o=>{e=new self[C(`-${t}-observer`)](o,r),n.map(i=>e.observe(i,r))}).cleanup(()=>e.disconnect())}},{get:(t,r)=>t[r]??t.does.bind(null,r.replace(/s$/,""))});var j=(n,t=queueMicrotask)=>{let r,e=new $().then(()=>{let o=l(["undo","live"],n);r=l.ignore(()=>x(o.live).change()).once().then(()=>t(()=>e.now())).cleanup(()=>o.undo())}).cleanup(()=>r?.stop());return t(()=>e.now()),e};var d=n=>new F({t:{$:d.get(n)}},"$").e,N=new WeakMap,L=new WeakMap,F=class{constructor(t,r,e=this){this.r=t,this.i=r,this.m=e,this.a={},this.e=new Proxy(new EventTarget,{get:(o,i)=>i==Symbol.iterator?()=>(l.add("live",this.e,"keychange"),[...this.t].map((s,u)=>this.n(u).e)[i]()):i[0]=="$"?this.n(i.slice(1)).e:o[i]?o[i].bind(o):(l.add("live",this.n(i).e,"deepchange"),this.t?.[i]),set:(o,i,s)=>d.set(this.n(i).e,s),deleteProperty:(o,i,s)=>d.delete(this.n(i).e),has:(o,i)=>(l.add("live",this.e,"keychange"),this.t!=null&&i in this.t||o[i]),ownKeys:()=>(l.add("live",this.e,"keychange"),Object.keys(this.t??{}).map(o=>`$${o}`)),getOwnPropertyDescriptor:()=>({configurable:!0,enumerable:!0}),defineProperty:()=>!1}),N.set(this.e,this),e==this&&L.set(this,new Set),L.get(e).add(new WeakRef(this)),this.t=this.r.t?.[this.i],this.f=Object.keys(this.t??{})}n(t){return this.a[t]??=new F(this,t,this.m)}c(t,r=new Set([this])){let e=t?.(),o=this.t,i=this.r.t?.[this.i];this.t=i,Object.is(o,i)||this.e.dispatchEvent(new CustomEvent("change",{detail:{oldValue:o,value:i}}));let s=Object.keys(this.t??{}),u=new Set(this.f);this.f=s;for(let a of s)u.has(a)?u.delete(a):u.add(a);u.size&&this.e.dispatchEvent(new CustomEvent("keychange",{detail:{keys:[...u]}}));let c=this.r;for(r.add(this);!r.has(c)&&c.r;)c.c(null,r),c=c.r;if(Object.is(o,i))return e;for(let a of Object.values(this.a))a.c(null,r);if(t){for(let a of r)a.e.dispatchEvent(new CustomEvent("deepchange"));return e}}};d.get=(n,t)=>{let r=N.get(n);return r?t!=null?r.n(t).t:(l.add("live",n,"deepchange"),r.t):t==null?n:n[t]};d.set=(n,t)=>{let r=N.get(n);return!!r?.c(()=>r.r.t==null?!1:(r.r.t[r.i]=d.get(t),!0))};d.delete=(n,t)=>{let r=N.get(n);return!!r?.c(()=>r.r.t==null?!1:delete r.r.t[r.i])};d.link=(n,t)=>{let r,e=t;t instanceof HTMLElement?e={get:()=>t.value,set:u=>t.value=u,changes:x(t).input()}:typeof t=="function"&&(e={get:()=>r,changes:j(()=>r=t(),u=>u())});let o,i=u=>{o=!0,d.set(n,u),r=u,o=!1},s=x(n).deepchange().then(()=>{if(!o){if(!e.set)return i(r);e.set(l.ignore(()=>d.get(n))),i(l.ignore(e.get))}});return i(l.ignore(e.get)),(e.changes??new $).then(()=>i(l.ignore(e.get))).if(()=>null).cleanup(()=>s.stop())};var l=(n,t)=>{let r=l[v];l[v]={};let e={};return n.map(o=>{l[v][o]=new l[p][o],e[o]=l[v][o].result}),e.result=t(),l[v]=r,e},z=n=>{if(!l[v])return n;let t=l[v];return{then:r=>Promise.resolve(n).then(e=>{Object.keys(t).some(o=>t[o].until?.())||(queueMicrotask(()=>l[v]=t),r(e),queueMicrotask(()=>l[v]=null))})}};l.ignore=n=>l([],n).result;l.add=(n,...t)=>{l[v]?.[n]?.add(...t)};l.register=(n,t)=>{l[p][n]??=t};l[p]={result:!0,undo:class{[p]=[];#t;result=()=>{this.#t||(this[p].splice(0).map(n=>n()),this.#t=!0)};add(n){if(this.#t)return n();this[p].push(n)}until(){return this.#t}},live:class{[p]=new Map;result=new EventTarget;add(n,t){let r=this[p].get(n)??[];r.includes(t)||(r.push(t),this[p].set(n,r),l.ignore(()=>x(n).does(t)).then(()=>this.result.dispatchEvent(new CustomEvent("change"))))}}};var H=n=>{let t;return(...r)=>(t?.undo(),t=l(["undo"],()=>n(...r)),t.result)};var P=n=>{let t;return new $(r=>t=setInterval(r,n)).cleanup(()=>clearInterval(t))},D=n=>P(n).once(),R=()=>{let n;return new $(t=>{let r=()=>n=requestAnimationFrame(e=>{r(),t(e)});r()}).cleanup(()=>cancelAnimationFrame(n))},W=()=>{let n=0;return R().if(()=>n++).once()};var m=n=>{let t={x:new Set(["query","$"]),o:new WeakMap,s:class extends HTMLElement{constructor(){super(),t.o.set(this,{x:{}}),l.ignore(()=>e.constructor.call(this,t.o.get(this)))}}},r={};n(Object.fromEntries(m[p].map(([o,i])=>[i,(...s)=>(r[i]??=[]).push(s)])));let e=I(m[p].map(([o,i])=>o(t,r[i]??[])));return Object.entries(e).map(([o,i])=>t.s.prototype[o]??=function(...s){return l.ignore(()=>i.call(this,t.o.get(this),...s))}),customElements.define(t.p,t.s),customElements.whenDefined(t.p)};m[p]=[];m.register=(n,t,r)=>{m[p].push([r,t,n]),m[p].sort((e,o)=>e[2]-o[2])};var O=async n=>{if(O[p].has(`${n}`))return;O[p].add(`${n}`);let t=await fetch(n),r=document.createElement("template");return r.innerHTML=await t.text(),m(e=>{for(let o of r.content.children)e[o.localName]?.(Object.fromEntries([...o.attributes].map(i=>[C(i.name),i.value])),o.innerHTML)})};O[p]=new Set;var V;O.auto=n=>{if(O.auto[p])return;O.auto[p]=new Set;let t=e=>{if(O.auto[p].has(e))return;O.auto[p].add(e);let o=n(e);o&&O(o)},r=e=>{for(let o of e.querySelectorAll(":not(:defined)"))t(o.localName);for(let o of e.querySelectorAll("template"))r(o.content)};return m.register(6,Symbol(),e=>V?{}:(e.u&&r(e.u),{}),{}),x(document).observes("mutation",{childList:!0,subtree:!0}).then(()=>r(document)).now().if(()=>null).cleanup(()=>V=!0)};m.register(0,"title",(n,[t])=>(n.p=t[1],{}));m.register(1,"meta",(n,t)=>{let r=t.filter(s=>s[0].attribute),e=[...t.filter(s=>s[0].property),...r.filter(s=>s[0].type).map(s=>[{property:s[0].as??C(s[0].attribute)}]),...t.filter(s=>s[0].method).map(s=>[{property:s[0].method,readonly:!0}])];return e.map(([s])=>{let u=function(){return l.ignore(()=>d.get(n.o.get(this).x.$,s.property))};Object.defineProperty(n.s.prototype,s.property,"readonly"in s?{get:u}:{get:u,set:function(c){n.o.get(this).x.$[s.property]=c}})}),n.s.observedAttributes=r.map(s=>s[0].attribute),n.s.formAssociated=t.some(s=>s[0].formAssociated!=null),{constructor:function(s){s.x.$=d({attributes:{}}),r.map(([u])=>{let c=C(u.attribute);if(s.x.$.$attributes[c]=null,x(s.x.$.$attributes[`$${c}`]).change().then(()=>{let a=d.get(s.x.$.$attributes,c);a==null?this.removeAttribute(u.attribute):this.setAttribute(u.attribute,a)}),u.type=="boolean")d.link(s.x.$[`$${u.as??c}`],{get:()=>d.get(s.x.$.$attributes,c)!=null,set:a=>s.x.$.$attributes[c]=a?"":null,changes:x(s.x.$.$attributes[`$${c}`]).change()});else if(u.type){let a=self[C(`-${u.type}`)];d.link(s.x.$[`$${u.as??c}`],{get:()=>a(d.get(s.x.$.$attributes,c)??u.default??""),set:f=>s.x.$.$attributes[c]=f==null?null:`${f}`,changes:x(s.x.$.$attributes[`$${c}`]).change()})}}),e.map(([{property:u}])=>{if(!Object.hasOwn(this,u))return;let c=this[u];delete this[u],this[u]=c})},attributeChangedCallback:function(s,u,c,a){s.x.$.$attributes[C(u)]=a}}});m.register(2,"meta",(n,t)=>I([...t,[{hook:"connected",unhook:"disconnected"}],[{hook:"disconnected"}]].map(r=>{let{hook:e,unhook:o}=r[0];if(!e)return{};n.x.add(e);let i=function(u){u.x[e]=c=>{let a=[new $().then((...f)=>{a[1]?.undo(),a[1]=l(["undo"],()=>c?.(...f))}).cleanup(()=>{a[1]?.undo(),u.x[e][p].delete(a)})];return u.x[e][p].add(a),u.x[e][v]&&queueMicrotask(()=>a[0].now(...u.x[e][v])),a[0]},u.x[e][p]=new Set},s=function(u,...c){u.x[e][v]=c;for(let a of u.x[e][p])a[0].now(...c)};return o?{constructor:i,[`${e}Callback`]:s,[`${o}Callback`]:function(u,...c){u.x[e][v]=null;for(let a of u.x[e][p])a[1]?.undo()}}:{constructor:i,[`${e}Callback`]:s}})));m.register(3,Symbol(),n=>{let t=new Map,r=(o,...i)=>{if(t.get(o))return t.get(o);let s=[];t.set(o,s);let u=document.createNodeIterator(o,5),c;for(;c=u.nextNode();)if(c.nodeType==3){let a=c.textContent.split(/{{([^]*?)}}/g);c.after(...a),c.remove(),s.push(...a.map((f,b)=>{if(c=u.nextNode(),b%2==0)return;let y=new Function(...i,`return(${c.textContent})`);return(S,w,h)=>S.x.connected(()=>j(()=>w.textContent=y(...h.map(g=>g[1]))))}))}else if(c.getAttribute("#for")){let[a,f]=c.getAttribute("#for").split(" of ");c.before(""),c.removeAttribute("#for"),c.remove();let b=c,y=new Function(...i,`return(${f})`);s.push((S,w,h)=>{let g=[];S.x.connected(()=>j(()=>{let k=[...y.call(c,...h.map(M=>M[1]))];for(;g.length>k.length;)g.pop()[1].undo();k.map((M,E)=>{if(g[E]&&g[E][0]===M)return;let A=l(["undo"],()=>{let T=S.l(b,[...h,[a,M]]),q=T.nodeType==11?T.childNodes:[T];return l.add("undo",()=>q.map(K=>K.remove())),(g[E-1]?.[1].result.at(-1)??w).after(...q),q});g[E]?.[1](),g[E]=[M,A]})}))})}else if(c.getAttribute("#if")){c.before("");let a=c.previousSibling,f=[],b=[],y=w=>{let h=a.nextElementSibling;if(h?.hasAttribute(w))return f.push(`()=>(${h.getAttribute(w)||!0})`),b.push(h.localName=="template"?h.content:h),h.removeAttribute(w),h.remove(),!0};for(y("#if");y("#else-if"););y("#else");let S=new Function(...i,`return[${f}].findIndex(e=>e())`);s.push((w,h,g)=>{let k,M=[];w.x.connected(()=>j(()=>{let E=S.call(null,...g.map(q=>q[1]));if(E==k||(k=E,M.splice(0).map(q=>q.remove()),!b[E]))return;let A=w.l(b[E],g),T=A.nodeType==11?A.childNodes:[A];M.push(...T),h.after(...T)}))})}else{let a=[...c.attributes].map(f=>{if(f.name[0]==":"){let b=f.name.slice(1),y=new Function(...i,`return(${f.value})`);return c.removeAttribute(f.name),(S,w,h)=>S.x.connected(()=>j(()=>{let g=y.call(w,...h.map(k=>k[1]));g==null?w.removeAttribute(b):w.setAttribute(b,g)}))}else if(f.name[0]=="."){let b=f.name.slice(1).split(".").at(-1),y=f.name.slice(1).split(".").map(C),S=new Function(...i,`return(${f.value})`);return c.removeAttribute(f.name),(w,h,g)=>w.x.connected(()=>j(()=>{let k=S.call(h,...g.map(T=>T[1])),M=[...y],E=M.pop(),A=h;M.map(T=>A=A?.[T]),A!=null&&(A instanceof DOMTokenList?A.toggle(b,k):A[E]=k)}))}else if(f.name[0]=="@"){let b=f.name.slice(1),y=new Function(...i,"event",f.value);return c.removeAttribute(f.name),(S,w,h)=>S.x.connected(()=>{x(w).does(b).then(g=>l.ignore(()=>{y.call(w,...h.map(k=>k[1]),g)}))})}});s.push((...f)=>{a.map(b=>b?.(...f))})}return s};return{constructor:function(o){o.l=(i,s)=>{let u=r(i,...s.map(f=>f[0])),c=i.cloneNode(!0),a=document.createNodeIterator(c,5);return u.map(f=>{let b=a.nextNode();f?.(o,b,s)}),c}}}});m.register(5,"template",(n,[t])=>{if(!t)return{constructor:function(e){e.root=this}};let r=document.createElement("template");return r.innerHTML=t[1],n.u=r.content,t[0].mode?{constructor:function(e){e.root=this.attachShadow(t[0]),e.root.append(e.l(n.u,[[`{${[...n.x]}}`,e.x]])),customElements.upgrade(e.root)}}:{constructor:function(e){e.root=e.l(n.u,[[`{${[...n.x]}}`,e.x]]),customElements.upgrade(e.root)},connectedCallback:function(e){e.root!=this&&(this.replaceChildren(e.root),e.root=this)}}});m.register(7,Symbol(),n=>({constructor:function(r){r.x.query=e=>r.root.querySelector(e),r.x.query.all=e=>[...r.root.querySelectorAll(e)]}}));m.register(8,"style",(n,[t])=>{if(!t)return{};let r=new CSSStyleSheet;return r.replace(t[1]),{connectedCallback:function(e){let o=e.root.mode?e.root:this.getRootNode(),i=o.adoptedStyleSheets;i.includes(r)||(o.adoptedStyleSheets=[...i,r])}}});m.register(10,"script",(n,[t])=>{if(!t)return{};let r=new Function(`{${[...n.x]}}`,`const{${Object.keys(self.yozo)}}=self.yozo;${t[1]}`);return{constructor:function(e){r.call(this,e.x)}}});self.yozo={monitor:l,until:z,Flow:$,live:d,when:x,purify:H,effect:j,frame:R,interval:P,paint:W,timeout:D};Object.defineProperty(self.yozo,"register",{value:O});})();
