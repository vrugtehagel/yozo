let y={};function h(n){const e=function(...t){return e.do.apply(this,t).result};return e.do=h.do(n),e}h.do=n=>function(...e){const t=y;y={};const r={result:n.apply(this,e)};for(const o of Reflect.ownKeys(v)){const{transform:c,bucket:i}=v[o];r[o]=c(o in y?y[o]:i())}return y=t,r},h.define=n=>(...e)=>{const{result:t,...s}=n(...e);if(y)for(const r of Reflect.ownKeys(s)){if(!v[r])continue;const{bucket:o,add:c}=v[r];r in y||(y[r]=o()),c(y[r],s[r])}return t},h.register=(n,e)=>{n!="result"&&(v[n]??=e)};const v={};h.register("undo",{bucket:()=>[],add:(n,e)=>n.unshift(e),transform:n=>{let e=!1;return()=>{e||(e=!0,n.forEach(t=>t()))}}}),h.register("watch",{bucket:()=>new Set,add:(n,e)=>n.add(e),transform:n=>n});const S=[];let A=!1,q,x;function d(n){A||L(),x&&F(),q=n,x=new Map(S.map(([e])=>[e,[]])),queueMicrotask(()=>{x&&F(),x=null})}d.register=(n,e,t)=>{A||(S.push([e,t]),n&&(d[n]=(...s)=>x.get(e).push(s)))};function L(){A=!0,S.sort(([,n],[,e])=>n-e)}const $=new WeakMap;async function F(){const n=q;class e extends HTMLElement{constructor(){super();$.set(this,{}),r("constructor",this,[])}}const t={body:e,name:n},s=(await Promise.all(S.map(([c])=>c.call(t,x.get(c))))).filter(c=>c),r=(c,i,a)=>s.map(u=>u[c]).forEach(u=>u?.call(i,$.get(i),...a)),o=new Set(s.flatMap(c=>Object.keys(c)));o.delete("constructor");for(const c of o)e.prototype[c]=function(...i){r(c,this,i)};customElements.define(n,e)}const g=h.define(n=>({watch:n}));class j{#e=[];#r=[];#o=[];constructor(e){e((...t)=>this.#t(...t))}#t(...e){for(const t of this.#e)if(t(...e))return}#n(){this.#o.forEach(e=>e()),this.#r.forEach(e=>e.#n?.())}then(e){return this.#e.push((...t)=>{e(...t)}),this}cleanup(e){return this.#o.push(e),this}only(e){return this.#e.push((...t)=>!e(...t)),this}or(e){return this.#r.push(e),e.then((...t)=>this.#t(...t)),this}after(e){return queueMicrotask(()=>queueMicrotask(e)),this}until(e){return typeof e=="function"?handlers.push((...t)=>handler(...t)&&!this.#n()):Promise.resolve(e).then(()=>this.#n()),this}now(...e){return this.#t(...e),this}}function k(...n){const e=h.define((r,o)=>{let c;const i=new j(u=>{c=u,n.forEach(l=>l.addEventListener(r,c,o))}),a=()=>n.forEach(u=>u.removeEventListener(r,c,o));return i.cleanup(a),{result:i,undo:a}}),t=h.define((r,o)=>{const c=r[0].toUpperCase()+r.slice(1);let i;const a=new j(l=>{i=new self[c+"Observer"](l),n.forEach(f=>i.observe(f,o))}),u=()=>i?.disconnect();return a.cleanup(u),{result:a,undo:u}}),s=(r,o)=>{if(o=="does")return e;if(o=="observes")return t;const c=k.strict?o:o.replace(/s$/,"");return i=>e(c,i)};return new Proxy({does:e,observes:t},{get:s})}function _(n,e){if(n===e)return!0;if(typeof n!=typeof e||typeof n!="object")return!1;const t=new Set(Object.keys(n)),s=new Set(Object.keys(e));if(t.size!=s.size)return!1;for(const r of t)if(!s.has(r))return!1;return!0}class H{constructor(e){this.reference=e}[Symbol.toPrimitive](){if(!this.reference.isObject)return()=>this.reference.value}valueOf(){return()=>this.reference.value}toJSON(){return()=>this.reference.value}toString(){return()=>this.reference.value.toString()}}function m(n){const e={_:m.get(n)},{proxy:t}=new b({value:e},"_",!0);return t}class b{static symbol=Symbol();static roots=new Map;static children=new WeakMap;cache;handler=new I(this);reader=new H(this);variable=new E(this);constructor(e,t,s=!1){const r=b.children.get(e),o=r?.[t];if(o)return o;r?r[t]=this:b.children.set(e,{[t]:this}),s?b.roots.set(this,new Set([this])):b.roots.get(e.root).add(this),this.parent=e,this.key=t,this.isRoot=s,this.root=s?this:e.root,this.proxy=new Proxy(()=>{},this.handler),this.cache=this.forceGetValue()}get object(){return this.parent.value}get value(){return this.cache}get isObject(){return this.value&&typeof this.value=="object"}get isFree(){return!this.isRoot&&!this.parent.isObject}change(e){e();const t=this.getChange();this.dispatchChange(t)}forceGetValue(){return this.isRoot?this.parent.value?.[this.key]:this.parent.forceGetValue()?.[this.key]}getInfo(){const e=this.parent?.proxy??null,t=this.isRoot?null:this.key,s=this.proxy;return{parent:e,key:t,source:s}}getChange(){const e=this.forceGetValue(),t=this.cache;return this.cache=e,{value:e,oldValue:t}}dispatchChange(e,t){if(e&&e.oldValue===e.value)return;const s=Boolean(t);t??=this.getInfo(),e??=this.getChange();const r={...t,...e};if(this.variable.dispatchEvent(new CustomEvent("change",{detail:r})),s)return;const o=new Set(b.roots.get(this.root)),c=new Map,i=new Set;for(const a of o){const u=a.getChange();if(u.oldValue!==u.value||a==this)c.set(a,u);else continue;let l=a;for(;!l.isRoot;)i.add(l),l=l.parent}i.add(this.root);for(const a of i){if(a==this)continue;const u=c.get(a);a.dispatchChange(u,t)}}}class I{constructor(e){this.reference=e}get(e,t){return t==b.symbol?this.reference:this.reference.reader[t]?(g(this.reference.proxy),this.reference.reader[t]()):new b(this.reference,t).proxy}set(e,t,s){return this.reference.proxy[t].set(s),!0}deleteProperty(e,t){return this.reference.proxy[t].delete(),!0}apply(e,t,s){const{object:r,key:o,parent:c}=this.reference;if(o in E.prototype)return c.variable[o](...s);if(g(this.reference.parent.proxy),!c.isRoot&&!c.isObject)return r[o](...s);const i={...r},a=r[o](...s),u=this.reference.object,l=new Set(Object.keys(u));for(const f of Object.keys(i))l.add(f);for(const f of l)if(!_(i[f],u[f])){c.dispatchChange();break}return a}ownKeys(e){return g(this.reference.proxy),this.reference.isObject?Object.keys(this.reference.value):[]}has(e,t){return g(this.reference.proxy),this.reference.isObject&&t in this.reference.value}getPrototypeOf(e){return g(this.reference.proxy),E.prototype}getOwnPropertyDescriptor(e,t){if(g(this.reference.proxy),!!this.reference.isObject)return{configurable:!0,enumerable:!0}}}class E extends EventTarget{constructor(e){super();this.reference=e}is(e){return g(this.reference.proxy),this.reference.value==m.get(e)}get(){return g(this.reference.proxy),this.reference.value}set(e){return this.reference.change(()=>this.reference.object[this.reference.key]=m.get(e))}delete(){return this.reference.change(()=>delete this.reference.object[this.reference.key])}free(){return g(this.reference.proxy),this.reference.isFree}typeof(){return g(this.reference.proxy),typeof this.reference.value}#e({get:e,set:t,triggers:s}){const r=this.reference.proxy;let o=!1;r.set(e()),k(r).change().then(()=>{o||t(r)}),s.now().then(()=>{o=!0,r.set(e()),o=!1})}bind(e){return e?this.#e(e):{input:o=>this.#e({get:()=>o.value,set:c=>o.value=c,triggers:k(o).inputs()}),attribute:(o,c)=>this.#e({get:()=>o.getAttribute(c),set:i=>o.setAttribute(c,i),triggers:k(o).observes("mutation",{attributes:!0,attributeFilter:[c]})}),css:(o,c)=>this.#e({get:()=>getComputedStyle(o).getPropertyValue(c),set:i=>o.style.setProperty(c,i),triggers:k(o).observes("mutation",{attributes:!0,attributeFilter:["style"]})})}}}m.get=n=>n?.[b.symbol]?n.get():n,m.made=n=>!!n?.[b.symbol],m.typeof=n=>typeof m.get(n);function O(n){return n.replace(/-+\w/g,e=>e.slice(-1).toUpperCase())}function K(n){return n.replace(/([A-Z])/g,"-$1")}function T(n,e,t){t==null?n.removeAttribute(e):n.setAttribute(e,t)}d.register(null,function(){return{constructor:function(s){s.exposed={host:this}},connectedCallback:function(s){s.connected=!0},disconnectedCallback:function(s){s.connected=!1}}},5),d.register(null,function(){return{constructor:function(e){const t={},s=c=>e.root.querySelector(c),r=c=>[...e.root.querySelectorAll(c)],o=(c,i)=>{if(i=="all")return r;const a=K(i);return t[i]??=s(`#${a}`)??s(a),i!=a&&(t[i]??=s(`#${i}`)),t[i]};e.exposed.elements=new Proxy(s,{get:o})}}},10),d.register("shadow",function([n]){const e=this,t=n?.[0];return t?(e.shadow=t,{constructor:function(r){r.exposed.internals=this.attachInternals(),r.root=this.attachShadow(t)}}):void 0},15),d.register("template",function([n]){const e=this;return n?(e.template=n[0],{constructor:function(r){if(r.root)return r.root.innerHTML=e.template;const o=document.createElement("template");o.innerHTML=e.template,r.root=o.content},connectedCallback:function(r){e.shadow||r.didConnect||!e.template||(this.replaceChildren(r.root),r.root=this)}}):void 0},20),d.register("style",function([n]){if(!n)return;const e=this,t=new CSSStyleSheet;return t.replace(n[0]),{constructor:function(o){!e.shadow||(o.root.adoptedStyleSheets=[t])},connectedCallback:function(o){if(e.shadow)return;const c=this.getRootNode(),i=c.adoptedStyleSheets;i.includes(t)||(c.adoptedStyleSheets=[...i,t])}}},25),d.register("form",function([n]){if(!n)return;const e=this,t={get:()=>!0};Object.defineProperty(e.body,"formAssociated",t)},30),d.register("attribute",function(n){const e=this,{body:t}=e,{prototype:s}=t,r=n.map(([u])=>u);Object.defineProperty(t,"observedAttributes",{get:()=>r});const c=Object.fromEntries(r.map(u=>[O(u),null]));for(const[u,l]of n){const f=Array.isArray(l.as)?l.as:[l.as??O(u)],{type:p}=l,C=p===Boolean,D={get:C?function(){return this.hasAttribute(u)}:function(){const w=this.getAttribute(u);return w==null?l.default??null:p(w)},set:C?function(w){this.toggleAttribute(u,!!w)}:function(w){T(this,u,w)},configurable:!0};for(const w of f)Object.defineProperty(s,w,D)}const i=function(u){const l=m({...c});u.exposed.attributes=l;for(const f of r){const p=O(f);l[p].addEventListener("change",()=>{l[p].is(this.getAttribute(f))||T(this,f,l[p].get())})}},a=h(function(u,l,f,p){const{attributes:C}=u.exposed;C[O(l)]=p});return{constructor:i,attributeChangedCallback:a}},35),d.register("require",async function(n){const e=n.flat();this.requires=e,await Promise.all(e.map(t=>customElements.whenDefined(t)))},40),d.register("state",function([n]){const e=h(n?.[0]??(()=>({})));return{constructor:s=>s.exposed.state=e()}},50),d.register("shape",function([n]){if(!n)return;const e=this,{prototype:t}=e.body,s=n[0],r=Object.getOwnPropertyDescriptors(s.prototype),o=new WeakMap;for(const[i,a]of Object.entries(r)){const u=a.get||a.set?{get:()=>o.get(this)[i],set:l=>o.get(this)[i]=l}:{value:function(...l){return o.get(this)[i](...l)}};Object.defineProperty(t,i,{...a,...u})}return{constructor:function(i){const a=new s(i.exposed);o.set(this,a),Object.assign(a,i.exposed)}}},55),d.register("construct",function([n]){if(!n)return;const e=h(n[0]);return{constructor:function(s){e.call(this,{...s.exposed})}}},60),d.register("connect",function([n]){if(!n)return;const e=h(n[0]),t=function(r){r.didConnect=!0,r.connect=e.do.call(this,{...r.exposed})},s=h(r=>r.connect.undo());return{connectedCallback:t,disconnectedCallback:s}},65),d.register("disconnect",function([n]){!n||h(n[0])},70),d.register("update",function(n){const e=n.map(r=>h(r[0]));return{constructor:function(r){r.updateQueue=new Set;for(const o of e){const c=()=>{r.connected?queueMicrotask(i):r.updateQueue.add(i)},i=h(async()=>{const a=o.do.call(this,r.exposed,c),u=new AbortController,{signal:l}=u,f=[...a.watch];await Promise.any(f.map(p=>when(p).change({signal:l}))),u.abort(),a.undo(),c()});c()}},connectedCallback:function(r){r.updateQueue.forEach(o=>o()),r.updateQueue.clear()}}},75);const V={};async function P(n){let t=await(await fetch(n)).text();const r=new DOMParser().parseFromString(t,"text/html"),o=r.querySelector("template")?.innerHTML,c=r.querySelector("style")?.textContent,i=r.querySelector("script").textContent,a=p=>p.replace(/([`\\])/g,"\\$1"),u=crypto.randomUUID(),l=new Promise(p=>window[u]=p),f=document.createElement("script");f.type="module",f.textContent=`import{define,when}from"${V.url}";
const{construct,connect,disconnect,update}=define;
${i};
${o&&`define.template(\`${a(o)}\`);`}
${c&&`define.style(\`${a(c)}\`);`}
window["${u}"]()
`,document.head.append(f),await l,delete window[u],f.remove()}P.auto=n=>{const e=new Set;function t(r){r.querySelectorAll(":not(:defined)").forEach(({localName:o})=>s(o))}function s(r){const o=n(r.toLowerCase());if(e.has(r)||(e.add(r),!o))return;/\.m?js$/.test(o)?import(o):P(o)}d.register(null,function(){const r=this;return r.requires.forEach(s),{constructor:function(i){!r.shadow||t(i.root)},connectedCallback:function(i){r.shadow||i.didConnect||t(this)}}},45),t(document)};function M(n,e){return h.define((...t)=>{let s;const r=new j(c=>s=n(c,...t)),o=()=>e(s);return r.cleanup(o),{result:r,undo:o}})}const U=M(setTimeout,clearTimeout),G=M(setInterval,clearTimeout),N=M(requestAnimationFrame,cancelAnimationFrame);async function Q(){return h.define((...n)=>{let e;const t=new j(r=>e=requestAnimationFrame(()=>e=requestAnimationFrame(r))),s=()=>cancelAnimationFrame(e);return t.cleanup(s),{result:t,undo:s}})}const R=import.meta;Object.assign(V,R);export{d as define};export{P as register};export{h as trackable};export{m as watch};export{k as when};export{U as timeout};export{G as interval};export{N as frame};export{Q as paint};
