let m=null;const $=(e,t)=>{const n=t?async function(...r){return e.apply(this,r).result}:function(...r){return e.apply(this,r).result};return n.do=function(...r){const s=this==n?e(...r):e.apply(this,r),{result:o}=s;let c=!1;return{result:o,undo:()=>{c||(c=!0,s.undo())},get undone(){return c}}},n},H=e=>function(...t){const n=m,r=[];m=r;const s=e.apply(this,t);m=n;const o=s.then(a=>(n?.unshift(c),m=n,a)),c=()=>s.then(()=>r.forEach(a=>a()));return{result:o,undo:c}},K=e=>function(...t){const n=m,r=[];m=r;const s=e.apply(this,t),o=()=>r.forEach(c=>c());return n?.unshift(o),m=n,{result:s,undo:o}};M.define=e=>$(function(...t){const n=e.apply(this,t),{result:r,undo:s}=n;return m?.unshift(s),{result:r,undo:s}});function M(e){const t=e.constructor.name=="AsyncFunction";return $(t?H(e):K(e),t)}async function Y(e){const t=m;return m=null,{then:r=>e.then(s=>(m=t,r(s)))}}let w=null;const D=(e,t)=>{const n=t?async function(...r){return e.apply(this,r).result}:function(...r){return e.apply(this,r).result};return n.do=function(...r){const s=this==n?e(...r):e.apply(this,r),{result:o}=s;let c=!1;return{result:o,undo:()=>{c||(c=!0,s.undo())},get undone(){return c}}},n},G=e=>function(...t){const n=w,r=[];w=r;const s=e.apply(this,t);w=n;const o=s.then(a=>(n?.unshift(c),w=n,a)),c=()=>s.then(()=>r.forEach(a=>a()));return{result:o,undo:c}},J=e=>function(...t){const n=w,r=[];w=r;const s=e.apply(this,t),o=()=>r.forEach(c=>c());return n?.unshift(o),w=n,{result:s,undo:o}};O.define=e=>D(function(...t){const n=e.apply(this,t),{result:r,undo:s}=n;return w?.unshift(s),{result:r,undo:s}});function O(e){const t=e.constructor.name=="AsyncFunction";return D(t?G(e):J(e),t)}const I=e=>(...t)=>e.forEach(n=>n(...t));function Q(e){const t=O.define((s,o)=>{const c=[];let a,p=!1;const f=v=>(queueMicrotask(()=>queueMicrotask(v)),{then:i,timeout:b}),b=async v=>({then:C=>{const x=q=>{clearTimeout(j),e.removeEventListener(s,x,o),C(q)},j=setTimeout(()=>x(null),v);e.addEventListener(s,x,o)}}),i=v=>{if(c.push(v),p&&v(null),!(c.length>1))return a=I(c),e.addEventListener(s,a,o),{then:i}};return{undo:()=>e.removeEventListener(s,a,o),result:{now:()=>(p=!0,{then:i,after:f}),then:i,after:f,timeout:b}}}),n=O.define((s,o={})=>{const c=s[0].toUpperCase()+s.slice(1).toLowerCase(),a=globalThis[c+"Observer"];if(!a)return;let p;const f=[],b=y=>{if(f.push(y),!(f.length>1))return p=new a(I(f)),p.observe(e,o),{then:b}};return{undo:()=>p.disconnect(),result:{then:b}}}),r=(s,o)=>{if(o=="does")return t;if(o=="observes"&&e instanceof Node)return n;const c=o.replace(/s$/,"");return a=>t(c,a)};return new Proxy({does:()=>{},observes:()=>{}},{get:r})}const k=Symbol("is-state-variable");function X(e){e!=null&&e[k]&&(e=e.get());const t={thing:e};return new d(t,"thing").proxy}class d extends EventTarget{static map=new WeakMap;static parentMap=new WeakMap;static proxyActions=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","has","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"];object;key;callback;specials={valueOf:()=>this.value,toString:()=>this.value.toString(),get:()=>this.value,set:t=>{t!=null&&t[k]&&(t=t.get()),this.change(()=>this.object[this.key]=t)},delete:()=>this.change(()=>delete this.object[this.key]),typeof:()=>typeof this.value,addEventListener:(...t)=>this.addEventListener(...t),removeEventListener:(...t)=>this.removeEventListener(...t),dispatchEvent:(...t)=>this.dispatchEvent(...t)};constructor(t,n,r=null){d.map.has(t)||d.map.set(t,{});const s=d.map.get(t);if(s[n])return s[n];super();Object.assign(this,{object:t,key:n,callback:r}),s[n]=this,this.initialize(),this.changeValue(this.value)}get value(){return this.object[this.key]}get isObject(){return typeof this.value=="object"&&this.value!=null}get isArray(){return Array.isArray(this.value)}change(t){const n=this.value;t();const{value:r,key:s}=this;this.changeValue(r,n),this.dispatchValueChange(r,n),d.parentMap.get(this.object)?.forEach(o=>o.dispatchPropertyChange(s))}dispatchValueChange(t,n){if(t===n)return;const r={oldValue:n,value:t};this.dispatchEvent(new CustomEvent("valuechange",{detail:r})),this.dispatchEvent(new CustomEvent("change",{detail:r}))}dispatchPropertyChange(t){const n=t==null?{unknown:!0}:{property:t};this.dispatchEvent(new CustomEvent("propertychange",{detail:n})),this.dispatchEvent(new CustomEvent("change",{detail:n}))}changeValue(t,n){d.parentMap.get(n)?.delete(this),this.isObject&&(typeof t!="object"||t==null||(d.parentMap.has(t)||d.parentMap.set(t,new Set),d.parentMap.get(t).add(this)))}isPropertyReference(t){return this.isObject?this.isArray?typeof t=="symbol"?!1:!!(Number.isInteger(+t)&&t>=0):!0:!1}initialize(){const t=this.callback?function(){}:{},n={};n.get=(r,s)=>this.get(s),n.set=(r,s,o)=>(this.isPropertyReference(s)&&this.proxy[s].set(o),!0),n.deleteProperty=(r,s)=>{!this.isPropertyReference(s)||this.proxy[s].delete()},n.apply=(r,s,...o)=>this.callback.apply(s,...o);for(const r of d.proxyActions)n[r]??=(s,...o)=>Reflect[r](this.value,...o);this.proxy=new Proxy(t,n)}get(t){if(t==k)return!0;if(!this.isObject&&t==Symbol.toPrimitive)return()=>this.value;const n=this.specials[t];if((!this.isObject||this.isArray)&&n)return n;const r=this.getFlattenedValue(t);if(!this.isPropertyReference(t))return r;const s=this.value;return new d(s,t,n).proxy}getFlattenedValue(t){const n=this.value[t];return typeof n!="function"?n:this.isArray?(...r)=>this.callArrayMethod(this.value,t,...r):n.bind(this.value)}callArrayMethod(t,n,...r){const s=[...t],o=t,c=t[n](...r);if(!(s.length!=o.length||o.some((i,E)=>i!==s[E])))return c;const p=Math.max(s.length,o.length),f=[];for(let i=0;i<p;i++)o[i]!==s[i]&&f.push(i);for(const i of f)this.changeValue(o[i],s[i]);const b=d.map.get(t);for(const i of f)b?.[i]?.dispatchValueChange(o[i],s[i]);return d.parentMap.get(t)?.forEach(i=>i.dispatchPropertyChange()),c}}const V={url:"file:///Users/koen/Desktop/_personal/yozo/register.js",main:!1},Z=new Set;async function _(e,{as:t}={}){if(Z.has(e.toString()))return;const r=await(await fetch(e)).text(),o=new DOMParser().parseFromString(r,"text/html"),c=o.querySelector("template"),a=o.querySelector("script"),p=o.querySelector("style"),f=c.getAttribute("mode")??"open",b=c.hasAttribute("delegates-focus"),i=p?new CSSStyleSheet:null,E=new Map,y=await tt(a.textContent),{exposed:P,observed:v,form:C}=y,{internals:x,attributes:j,any:q,elements:z}=P;i?.replace(p.textContent),c.removeAttribute("mode"),c.removeAttribute("delegates-focus");const S=class extends HTMLElement{#t=null;[j]=(...u)=>{const g=new EventTarget;return E.set(u,g),g};[z]=Object.assign(u=>this[x].shadowRoot.querySelector(u),{all:u=>[...this[x].shadowRoot.querySelectorAll(u)]});constructor(){super();const u=this.attachShadow({mode:f,delegatesFocus:b});u.append(c.content.cloneNode(!0)),i&&(u.adoptedStyleSheets=[i]),this[x]=this.attachInternals(),y.construct?.call(this,this)}connectedCallback(){this.#t?.undo(),y.connect&&(this.#t=y.connect.do.call(this,this))}disconnectedCallback(){this.#t.undo(),y.disconnect?.()}attributeChangedCallback(u,g,R){if(g===R)return;const B={attribute:u,oldValue:g,value:R},N=()=>new CustomEvent("change",{detail:B});for(const[T,W]of E)(T.includes("*")||T.includes(u))&&W.dispatchEvent(N())}},F=(u,g)=>Object.defineProperty(S.prototype,u,g);for(const{name:u,method:g}of y.methods)F(u,{writable:!0,configurable:!0,value:g});for(const{name:u,descriptor:g}of y.properties)F(u,g);Object.defineProperty(S,"formAssociated",{get:()=>C}),Object.defineProperty(S,"observedAttributes",{get:()=>v}),customElements.define(t??y.name,S)}export{_ as register};const A=Symbol("secret");export{M as reversible,Y as until};export{Q as when};export{X as stateify};const l=e=>h.name=e,L=new Set,U=new Map;let h=null;l[A]={},l[A].getByUUID=e=>{const t=U.get(e);return U.delete(e),t},l[A].newContext=()=>({name:"",observed:[],properties:[],methods:[],form:!1,exposed:{internals:Symbol("internals"),attributes:Symbol("attributes"),any:Symbol("any"),elements:Symbol("elements")}}),l.context=e=>h?console.log({uuid:e}):(L.add(e),queueMicrotask(()=>{if(L.has(e))throw Error("Yozo: top level await not allowed in custom element definitions")}),h=l[A].newContext(),h.exposed),l.attribute=(e,t={})=>{if(h.observed.push(e),!t.type)return;const n=t.as??e.replace(/-+\w/g,s=>s.slice(-1).toUpperCase()),r=Array.isArray(n)?n:[n];for(const s of r)nt(e,{...t,as:s})},l.form=()=>{h.form=!0},l.property=(e,t)=>{typeof t=="function"&&(t={get:t}),h.properties.push({name:e,descriptor:t})},l.method=(e,t)=>{h.methods.push({name:e,method:t})},l.construct=e=>{h.construct=e},l.connect=e=>{h.connect=M(e)},l.disconnect=e=>{h.disconnect=e},l.done=(e,t)=>{if(!!h&&(L.delete(e),U.set(e,h),h=null,t))throw t};async function tt(e){const t=crypto.randomUUID(),n="application/javascript",r=new Blob([et(e,t)],{type:n}),s=URL.createObjectURL(r);return await import(s),URL.revokeObjectURL(s),l[A].getByUUID(t)}const et=(e,t)=>`
import { define } from "${new URL("./define.js",V.url)}";
import { when } from "${new URL("./index.js",V.url)}";
const { internals, attributes, any, elements } = define.context('${t}');
const { construct, connect, disconnect } = define;
try {

${e}

} catch (error) { define.done('${t}', error); }
define.done('${t}');
`.slice(1);function nt(e,t){const{type:n,as:r}=t;n==Boolean?l.property(r,{get(){return this.hasAttribute(e)},set(s){this.toggleAttribute(e,s)}}):l.property(r,{get(){const s=this.getAttribute(e);return s==null?t.default??null:n(s)},set(s){if(s==null)return this.removeAttribute(e);this.setAttribute(e,s)}})}
